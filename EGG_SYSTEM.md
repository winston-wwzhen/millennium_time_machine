# 彩蛋系统文档

> 千禧时光机 - Windows 98 桌面彩蛋收集系统
> 最后更新: 2025-12-29

---

## 概述

彩蛋系统是一个成就收集系统，玩家通过探索桌面功能发现隐藏彩蛋，获得**时光币**奖励。时光币可在网管系统兑换网费。

- **总彩蛋数**: 23个
- **数据存储**: 云端同步，跨设备保存
- **奖励范围**: 400 - 10000 时光币

---

## 彩蛋列表

### 🟢 普通彩蛋 (400-1000💎)

| 名称 | 奖励 | 触发方式 |
|------|------|----------|
| 🦁 舞动的小狮子 | 1000💎 | 点击小狮子 10 次 |
| 💬 它会说话 | 1000💎 | 长按小狮子 |
| 📂 底部秘密 | 1000💎 | 点击任务栏 10 次 |
| 🎨 换了个心情 | 500💎 | 双击桌面切换到第 2 个背景 |
| 💻 电脑专家 | 400💎 | 点击我的电脑图标 3 次 |
| 🌐 网瘾少年 | 400💎 | 点击浏览器图标 3 次 |
| 📸 非主流达人 | 800💎 | 在非主流相机保存 5 张照片 |
| 🏠 空间常客 | 600💎 | 累计访问 QCIO 空间 10 次 |
| 📋 开始菜单爱好者 | 500💎 | 累计打开开始菜单 20 次 |
| 🪐 火星文大师 | 700💎 | 累计使用火星翻译 10 次 |
| 💰 网费兑换者 | 500💎 | 首次在网管系统兑换网费 |
| 🔢 计算器高手 | 800💎 | 在计算器连续计算 10 次 |
| 🧭 浏览器领航员 | 1000💎 | 在浏览器使用前进/后退/刷新各 3 次 |

---

### 🔵 稀有彩蛋 (1000-2500💎)

| 名称 | 奖励 | 触发方式 |
|------|------|----------|
| 💻 那个年代的噩梦 | 2000💎 | 点击桌面左上角 50 次（蓝屏彩蛋） |
| 👁️ 消失的角落 | 2000💎 | 点击桌面右下角区域 |
| ⏰ 特殊时刻 | 1500💎 | 在整点或半点查看桌面 |
| 💬 聊天狂魔 | 2500💎 | 累计发送 100 条聊天消息 |
| 🗑️ 回收站清理者 | 1500💎 | 在回收站页面清空回收站 5 次 |
| 👥 群聊狂欢 | 2000💎 | 累计发送 50 条群聊消息 |
| 🌟 星际探险家 | 1500💎 | 在星际探索通关任意难度 |
| 🕰️ 时光旅行者 | 1200💎 | 在万年历查看 2006 年 6 月 |

---

### 🟣 史诗彩蛋 (5000💎)

| 名称 | 奖励 | 触发方式 |
|------|------|----------|
| 🌙 深夜党专属 | 5000💎 | 凌晨 0 点-1 点查看桌面 |

---

### 🟠 传说彩蛋 (10000💎)

| 名称 | 奖励 | 触发方式 |
|------|------|----------|
| 🎮 传说中的秘籍 | 10000💎 | KONAMI_CODE 序列：C→关→C→关→D→关→USB→关→D→关→C→关 → 关窗 → 小狮子 → 开始 |

---

## 按位置分类

### 🖥️ 桌面交互 (9个)

| 位置 | 彩蛋 |
|------|------|
| 小狮子 | 舞动的小狮子、它会说话 |
| 任务栏 | 底部秘密 |
| 桌面背景 | 换了个心情 |
| 桌面左上角 | 那个年代的噩梦 |
| 桌面右下角 | 消失的角落 |
| 特殊时间 | 特殊时刻、深夜党专属 |
| 开始菜单 | 开始菜单爱好者、传说中的秘籍(最后步) |
| 我的电脑 | 电脑专家、传说中的秘籍(前8步) |
| 浏览器图标 | 网瘾少年 |

### 🌐 功能模块 (14个)

| 位置 | 彩蛋 |
|------|------|
| 非主流相机 | 非主流达人 |
| QCIO空间 | 空间常客、火星文大师 |
| 网管系统 | 网费兑换者 |
| 聊天功能 | 聊天狂魔、群聊狂欢 |
| 回收站 | 回收站清理者 |
| 浏览器工具 | 计算器高手、星际探险家、时光旅行者、浏览器领航员 |

---

## 统计信息

| 分类 | 数量 |
|------|------|
| 🟢 普通彩蛋 | 13 |
| 🔵 稀有彩蛋 | 8 |
| 🟣 史诗彩蛋 | 1 |
| 🟠 传说彩蛋 | 1 |
| **总计** | **23** |

### 按触发类型

| 类型 | 数量 | 示例 |
|------|------|------|
| 点击计数 | 9 | 点击小狮子10次、点击任务栏10次 |
| 长按 | 1 | 长按小狮子 |
| 时间触发 | 2 | 整点查看、凌晨0点 |
| 序列操作 | 1 | KONAMI_CODE |
| 累计行为 | 10 | 聊天100条、清空回收站5次 |

---

## 文件结构

```
miniprogram/
├── utils/
│   └── egg-system.js          # 彩蛋系统核心逻辑
├── pages/
│   ├── index/index.js         # 桌面彩蛋触发
│   ├── browser/index.js       # 浏览器工具彩蛋
│   ├── qcio/index.js          # QCIO空间彩蛋
│   ├── chat/index.js          # 聊天彩蛋
│   ├── group-chat/index.js    # 群聊彩蛋
│   └── recycle-bin/index.js   # 回收站彩蛋
├── components/
│   ├── network-neighborhood/  # 网费兑换者
│   ├── my-computer/           # Konami Code 序列检测
│   ├── egg-folder/            # 彩蛋文件夹
│   └── egg-discovery-dialog/  # Win98风格发现弹窗
└── cloudfunctions/user/       # 云端计数逻辑
```

---

## 数据结构

```javascript
// users collection
{
  badges: [
    { name: '舞者', eggId: 'lion_dance', discoveredAt: Date }
  ],
  eggStats: {
    totalDiscovered: Number,
    totalEarned: Number,
    chatMessageCount: Number,        // 聊天狂魔
    groupChatMessageCount: Number,   // 群聊狂欢
    qcioSpaceVisitCount: Number,     // 空间常客
    recycleBinEmptyCount: Number,    // 回收站清理者
    marsTranslatorCount: Number      // 火星文大师
  }
}
```

---

## 开发指南

### 添加新彩蛋

1. **定义彩蛋** (`egg-system.js`)
```javascript
// EGG_IDS
NEW_EGG: 'new_egg',

// EGG_CONFIG
[EGG_IDS.NEW_EGG]: {
  name: '新彩蛋',
  description: '描述...',
  hint: '触发提示',
  rarity: 'common',
  type: 'action',
  reward: { coins: 500, badge: '徽章' }
}
```

2. **本地计数彩蛋** (点击、长按类)
```javascript
// 页面 data
data: { eggCount: 0, eggAchieved: false },

// 触发检查
onAction: function() {
  if (this.data.eggAchieved) return;
  this.setData({ eggCount: this.data.eggCount + 1 });
  if (this.data.eggCount >= 5) {
    this.setData({ eggAchieved: true });
    eggSystem.discover(EGG_IDS.NEW_EGG);
  }
}
```

3. **云端计数彩蛋** (累计行为类)
```javascript
// cloudfunctions/user/index.js
if (type === 'checkNewEgg') {
  const count = user.eggStats.newEggCount || 0;
  const newCount = count + 1;
  await db.collection('users').doc(user._id).update({
    data: { 'eggStats.newEggCount': newCount }
  });
  return { shouldTrigger: newCount >= 10 };
}

// 页面调用
const res = await userApi.checkNewEgg();
if (res.shouldTrigger) {
  eggSystem.discover(EGG_IDS.NEW_EGG);
}
```

---

## 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2025-12-29 | v3.7 | 修复 RECYCLE_BIN_EMPTYER 缺失定义 |
| 2025-12-29 | v3.6 | 新增 4 个浏览器工具彩蛋 |
| 2025-12-28 | v2.2 | Win98 风格彩蛋弹窗组件 |
| 2025-12-28 | v2.1 | 重构 KONAMI_CODE 序列触发 |
| 2025-12-28 | v2.0 | 新增行为类彩蛋（云端计数） |
| 2025-12-27 | v1.0 | 基础彩蛋系统 |
