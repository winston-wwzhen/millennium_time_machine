<view class="ttplayer-window {{show ? 'show' : 'hide'}}" catchtap="stopPropagation" style="{{overlayStyle}}">
  <!-- 2005é£æ ¼é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="title-bar">
    <view class="title-left">
      <text class="app-icon">ğŸµ</text>
      <text class="app-name">ååˆ†åŠ¨å¬ v3.2</text>
    </view>
    <view class="title-controls">
      <view class="control-btn" catchtap="onClose">Ã—</view>
    </view>
  </view>

  <!-- èœå•æ  (æš‚æœªå®ç°åŠŸèƒ½ï¼Œå…ˆéšè—) -->
  <!-- <view class="menu-bar">
    <text class="menu-item">æ–‡ä»¶(F)</text>
    <text class="menu-item">æ’­æ”¾(P)</text>
    <text class="menu-item">æŸ¥çœ‹(V)</text>
    <text class="menu-item">åˆ—è¡¨(L)</text>
    <text class="menu-item">å¸®åŠ©(H)</text>
  </view> -->

  <!-- ä¸»æ’­æ”¾åŒºåŸŸ -->
  <view class="main-area">
    <!-- æ€€æ—§æ¨¡æ‹Ÿæç¤ºæ¨ªå¹… -->
    <view class="simulation-banner">
      <text class="banner-icon">â„¹ï¸</text>
      <text class="banner-text">æ€€æ—§æ¨¡æ‹Ÿç¨‹åºï¼Œæ— å®é™…éŸ³ä¹æ’­æ”¾åŠŸèƒ½</text>
    </view>

    <!-- å¯è§†åŒ–æ•ˆæœåŒºåŸŸ -->
    <view class="visualizer">
      <!-- æ­Œæ›²ä¿¡æ¯æ˜¾ç¤º -->
      <view class="track-info">
        <text class="track-title">{{currentTrack.title}}</text>
        <text class="track-artist">{{currentTrack.artist}}</text>
        <text class="track-album">{{currentTrack.album}}</text>
      </view>

      <view class="visualizer-bg">
        <!-- é™æ€æ³¢çº¹ï¼Œæ— åŠ¨ç”» -->
        <view class="wave-container">
          <view class="wave-bar" wx:for="{{waveBars}}" wx:key="index" style="height: {{item}}px;"></view>
        </view>
      </view>
    </view>

    <!-- æ§åˆ¶é¢æ¿ -->
    <view class="control-panel">
      <!-- è¿›åº¦æ¡ -->
      <view class="progress-area">
        <text class="time-current">{{formatTime(currentTime)}}</text>
        <view class="progress-bar" bindtap="onSeek">
          <view class="progress-fill" style="width: {{progress}}%;"></view>
        </view>
        <text class="time-total">{{formatTime(duration)}}</text>
      </view>

      <!-- æ’­æ”¾æ§åˆ¶æŒ‰é’® -->
      <view class="play-controls">
        <button class="ctrl-btn" bindtap="onPrev">
          <text class="btn-icon">â®</text>
        </button>
        <button class="ctrl-btn main-play {{isLoading ? 'loading' : ''}}" bindtap="onPlayPause">
          <text class="btn-icon" wx:if="{{isLoading}}">â³</text>
          <text class="btn-icon" wx:else>â–¶</text>
        </button>
        <button class="ctrl-btn" bindtap="onNext">
          <text class="btn-icon">â­</text>
        </button>
      </view>

      <!-- éŸ³é‡æ§åˆ¶ -->
      <view class="volume-control">
        <text class="volume-icon">ğŸ”Š</text>
        <slider class="volume-slider"
                value="{{volume}}"
                min="0"
                max="100"
                bindchange="onVolumeChange"
                activeColor="#4a9eff"
                backgroundColor="#3a3a5e"
                block-size="12"/>
        <text class="volume-value">{{volume}}%</text>
      </view>

      <!-- æ’­æ”¾æ¨¡å¼ -->
      <view class="mode-controls">
        <text class="mode-btn {{mode === 'loop' ? 'active' : ''}}" bindtap="onModeChange" data-mode="loop">ğŸ” å¾ªç¯</text>
        <text class="mode-btn {{mode === 'random' ? 'active' : ''}}" bindtap="onModeChange" data-mode="random">ğŸ”€ éšæœº</text>
        <text class="mode-btn {{mode === 'single' ? 'active' : ''}}" bindtap="onModeChange" data-mode="single">ğŸ”‚ å•æ›²</text>
      </view>
    </view>

    <!-- æ’­æ”¾åˆ—è¡¨ -->
    <view class="playlist">
      <view class="playlist-header">
        <text class="playlist-title">æ’­æ”¾åˆ—è¡¨ ({{playlist.length}}é¦–)</text>
        <text class="playlist-btn" bindtap="onClearList">æ¸…ç©º</text>
      </view>
      <scroll-view class="playlist-scroll" scroll-y enable-flex enhanced show-scrollbar>
        <view class="playlist-item {{index === currentTrackIndex ? 'playing' : ''}}"
              wx:for="{{playlist}}"
              wx:key="id"
              bindtap="onSelectTrack"
              data-index="{{index}}">
          <text class="item-number">{{index + 1}}.</text>
          <view class="item-info">
            <text class="item-title">{{item.title}}</text>
            <text class="item-artist">{{item.artist}}</text>
          </view>
          <text class="item-duration" wx:if="{{item.duration}}">{{item.duration}}</text>
          <text class="item-playing" wx:if="{{index === currentTrackIndex && playing}}">ğŸµ</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- çŠ¶æ€æ  -->
  <view class="status-bar">
    <text class="status-text">{{statusText}}</text>
    <text class="status-time">{{currentTime}}</text>
  </view>

  <!-- Win98é£æ ¼æç¤ºå¼¹çª— -->
  <view class="win98-dialog-overlay" wx:if="{{showWin98Dialog}}" catchtap="closeWin98Dialog">
    <view class="win98-dialog-window" catchtap="stopPropagation">
      <view class="win98-dialog-title-bar">
        <text class="win98-dialog-title-text">{{win98DialogTitle}}</text>
        <view class="win98-dialog-close" bindtap="closeWin98Dialog">Ã—</view>
      </view>
      <view class="win98-dialog-content">
        <text class="win98-dialog-message">{{win98DialogMessage}}</text>
      </view>
      <view class="win98-dialog-actions">
        <button class="win98-dialog-btn" bindtap="closeWin98Dialog">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æ€€æ—§å¼¹çª— -->
  <view class="win98-dialog-overlay" wx:if="{{showNostalgia}}" catchtap="closeNostalgia">
    <view class="win98-dialog-window" catchtap="stopPropagation">
      <view class="win98-dialog-title-bar">
        <text class="win98-dialog-title-text">ğŸµ ååˆ†åŠ¨å¬å›å¿†</text>
        <view class="win98-dialog-close" bindtap="closeNostalgia">Ã—</view>
      </view>
      <view class="win98-dialog-content">
        <text class="win98-dialog-message">{{nostalgiaText}}</text>
      </view>
      <view class="win98-dialog-actions">
        <button class="win98-dialog-btn" bindtap="closeNostalgia">æˆ‘çŸ¥é“äº†</button>
      </view>
    </view>
  </view>
</view>
