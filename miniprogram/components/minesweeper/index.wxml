<view class="minesweeper-component" wx:if="{{show}}" style="z-index: {{zIndex}};" catchtap="stopPropagation" catchlongtap="stopPropagation" catchlongpress="stopPropagation">
  <!-- Win98 çª—å£ -->
  <view class="win98-window minesweeper-window">
    <!-- æ ‡é¢˜æ  -->
    <view class="win98-title-bar">
      <view class="win98-title-text">ğŸ’£ çœŸæ­£çš„æ‰«é›·</view>
      <view class="win98-btn-close" bindtap="onClose">Ã—</view>
    </view>

    <!-- çª—å£å†…å®¹ -->
    <view class="win98-window-body">
      <!-- æ¸¸æˆæ¨¡å¼é€‰æ‹© -->
      <view class="mode-selector">
        <view class="mode-buttons">
          <button class="win98-btn {{mode === 'pve' ? 'active' : ''}}" bindtap="setMode" data-mode="pve">äººæœº</button>
          <button class="win98-btn {{mode === 'pvp' ? 'active' : ''}}" bindtap="setMode" data-mode="pvp">åŒäºº</button>
        </view>
      </view>

      <!-- ç©å®¶åˆ†æ•°é¢æ¿ -->
      <view class="scoreboard">
        <!-- P1 è“æ–¹ -->
        <view class="player-card p1 {{turn === 'p1' ? 'active' : ''}}">
          <view class="player-header">
            <text class="player-name">è“æ–¹ (P1)</text>
            <text class="turn-badge {{turn === 'p1' ? 'show' : ''}}">å›åˆ</text>
          </view>
          <view class="player-score">{{scores.p1}}</view>
          <view class="player-label">å‰©ä½™é›·æ•°: {{totalMines - minesFound}}</view>
        </view>

        <!-- VS åˆ†éš” -->
        <view class="vs-divider">
          <text class="vs-text">VS</text>
        </view>

        <!-- P2 çº¢æ–¹/ç”µè„‘ -->
        <view class="player-card p2 {{turn === 'p2' ? 'active' : ''}}">
          <view class="player-header">
            <text class="player-name">{{mode === 'pve' ? 'ç”µè„‘' : 'çº¢æ–¹'}} (P2)</text>
            <text class="turn-badge {{turn === 'p2' ? 'show' : ''}}">å›åˆ</text>
          </view>
          <view class="player-score">{{scores.p2}}</view>
          <view class="player-label">é¢†å…ˆåˆ†: {{scores.p1 > scores.p2 ? scores.p1 - scores.p2 : scores.p2 - scores.p1}}</view>
        </view>
      </view>

      <!-- éš¾åº¦é€‰æ‹© -->
      <view class="difficulty-bar">
        <text class="difficulty-label">éš¾åº¦:</text>
        <view class="win98-dropdown">
          <view class="dropdown-trigger" bindtap="toggleDropdown">
            <text class="dropdown-value">{{difficultyNames[difficultyIndex]}}</text>
            <text class="dropdown-arrow {{showDropdown ? 'open' : ''}}">â–¾</text>
          </view>
          <view class="dropdown-menu {{showDropdown ? 'show' : ''}}" catchtap="stopPropagation">
            <view
              class="dropdown-item {{difficultyIndex === 0 ? 'selected' : ''}}"
              bindtap="selectDifficulty"
              data-index="0"
            >
              <text class="item-text">å° (10x10, 15é›·)</text>
              <text class="item-check" wx:if="{{difficultyIndex === 0}}">âœ“</text>
            </view>
            <view
              class="dropdown-item {{difficultyIndex === 1 ? 'selected' : ''}}"
              bindtap="selectDifficulty"
              data-index="1"
            >
              <text class="item-text">ä¸­ (16x16, 51é›·)</text>
              <text class="item-check" wx:if="{{difficultyIndex === 1}}">âœ“</text>
            </view>
          </view>
        </view>
        <button class="win98-btn-std restart-btn-small" bindtap="restartGame">é‡ç½®</button>
      </view>

      <!-- æ¸¸æˆç½‘æ ¼ -->
      <view class="grid-container">
        <view class="mine-grid" style="grid-template-columns: repeat({{cols}}, 1fr);">
          <block wx:for="{{grid}}" wx:key="row" wx:for-item="row">
            <block wx:for="{{row}}" wx:key="col" wx:for-item="cell">
              <view
                class="cell {{cell.isRevealed ? 'revealed' : ''}} {{cell.isMine && cell.isRevealed && cell.owner === 'p1' ? 'mine-p1' : ''}} {{cell.isMine && cell.isRevealed && cell.owner === 'p2' ? 'mine-p2' : ''}}"
                data-row="{{cell.row}}"
                data-col="{{cell.col}}"
                bindtap="onCellTap"
              >
                <block wx:if="{{cell.isRevealed}}">
                  <block wx:if="{{cell.isMine}}">
                    <text class="cell-icon">ğŸ’£</text>
                  </block>
                  <block wx:elif="{{cell.neighborMines > 0}}">
                    <text class="cell-num num-{{cell.neighborMines}}">{{cell.neighborMines}}</text>
                  </block>
                </block>
              </view>
            </block>
          </block>
        </view>
      </view>

      <!-- æ¸¸æˆè¯´æ˜ -->
      <view class="game-hint">
        <text>è§„åˆ™ï¼šç‚¹å‡»æ ¼å­ã€‚æŒ–åˆ°æ•°å­—æ¢äººï¼Œ</text>
        <text class="highlight">æŒ–åˆ°åœ°é›·å¾—åˆ†å¹¶ç»§ç»­ï¼</text>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
  <view class="win98-overlay" wx:if="{{showGameOver}}" bindtap="hideGameOver" catchlongtap="stopPropagation">
    <view class="win98-window game-over-dialog" catchtap="stopPropagation">
      <view class="win98-title-bar">
        <view class="win98-title-text">ğŸ† æ¸¸æˆç»“æŸ</view>
        <view class="win98-btn-close" bindtap="hideGameOver">Ã—</view>
      </view>
      <view class="win98-window-body">
        <view class="game-over-content">
          <view class="result-icon">{{winnerIcon}}</view>
          <text class="result-title">{{winnerTitle}}</text>
          <text class="result-subtitle">{{winnerSubtitle}}</text>
          <view class="final-score">
            <text class="score-p1">è“æ–¹: {{scores.p1}}</text>
            <text class="score-vs"> vs </text>
            <text class="score-p2">{{mode === 'pve' ? 'ç”µè„‘' : 'çº¢æ–¹'}}: {{scores.p2}}</text>
          </view>
        </view>
        <view class="dialog-actions">
          <view class="win98-btn-std" bindtap="restartGame">å†æ¥ä¸€å±€</view>
        </view>
      </view>
    </view>
  </view>
</view>
