<!-- å¿ƒæƒ…æ—¥å¿—ç”Ÿæˆå™¨ç»„ä»¶ -->
<view class="mood-log-container">
  <!-- ç”Ÿæˆå™¨åŒºåŸŸ -->
  <view class="section-title">âœï¸ å†™å¿ƒæƒ…æ—¥å¿—</view>
  <view class="log-generator">

    <!-- æ¯æ—¥å¥–åŠ±æç¤º -->
    <view class="reward-hint {{logStatus.canEarnReward ? 'has-reward' : 'no-reward'}}">
      <text class="hint-icon">{{logStatus.canEarnReward ? 'ğŸ’°' : 'ğŸ“Œ'}}</text>
      <text class="hint-text">
        {{logStatus.canEarnReward ? 'ä»Šæ—¥å‘å¸ƒæ—¥å¿—å¯è·å¾—é‡‘å¸å¥–åŠ±' : 'ä»Šæ—¥å¥–åŠ±å·²é¢†å®Œï¼Œæ˜å¤©å†æ¥~'}}
      </text>
      <text class="hint-count" wx:if="{{logStatus.canEarnReward}}">
        ({{logStatus.remainingCount}}/3)
      </text>
    </view>

    <!-- å¿ƒæƒ…é€‰æ‹© -->
    <view class="mood-selector">
      <view
        class="mood-item {{selectedMood && selectedMood.id === item.id ? 'selected' : ''}}"
        wx:for="{{moods}}"
        wx:key="id"
        bindtap="selectMood"
        data-mood="{{item}}"
      >
        <text class="mood-icon">{{item.icon}}</text>
        <text class="mood-name">{{item.name}}</text>
      </view>
    </view>

    <!-- å…³é”®è¯è¾“å…¥ -->
    <view class="keywords-input">
      <text class="input-label">å…³é”®è¯ï¼ˆé™10å­—ï¼‰:</text>
      <input
        class="win98-input"
        placeholder="æ¯”å¦‚ï¼šç­‰å¾…ã€æ¢¦æƒ³ã€ç›¸é‡..."
        value="{{keywords}}"
        bindinput="onKeywordsInput"
        maxlength="10"
      />
    </view>

    <!-- ç”ŸæˆæŒ‰é’® -->
    <button
      class="win98-btn-primary generate-btn"
      bindtap="generateLog"
      disabled="{{isGenerating}}"
    >
      {{isGenerating ? 'ç”Ÿæˆä¸­...' : 'ç”Ÿæˆæ—¥å¿—'}}
    </button>
  </view>

  <!-- å†å²æ—¥å¿—åˆ—è¡¨ -->
  <view class="section-title">ğŸ“œ æˆ‘çš„æ—¥å¿—</view>
  <view class="log-history">

    <view class="log-list" wx:if="{{logs.length > 0}}">
      <view
        class="log-item"
        wx:for="{{logs}}"
        wx:key="_id"
      >
        <!-- æ—¥å¿—å¤´éƒ¨ -->
        <view class="log-header" bindtap="toggleLog" data-index="{{index}}">
          <view class="log-mood">
            <text class="mood-emoji">{{item.mood_icon}}</text>
            <text class="mood-text">{{item.mood_name}}</text>
            <text class="reward-badge" wx:if="{{item.earnedReward}}">ğŸ’°+5</text>
          </view>
          <view class="log-time">{{item.createTimeStr}}</view>
        </view>

        <!-- æ—¥å¿—å†…å®¹ -->
        <view class="log-content {{showFullLog === index ? 'expanded' : ''}}">
          <text class="log-text">{{item.content}}</text>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="log-actions">
          <view class="action-btn" bindtap="copyLog" data-content="{{item.content}}">
            ğŸ“‹ å¤åˆ¶
          </view>
          <view class="action-btn delete-btn" bindtap="deleteLog" data-id="{{item._id}}">
            ğŸ—‘ï¸ åˆ é™¤
          </view>
          <view class="log-stats">
            ğŸ‘ï¸ {{item.visits || 0}}  |  â¤ï¸ {{item.likes || 0}}
          </view>
        </view>
      </view>
    </view>

    <view class="empty-logs" wx:else>
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">è¿˜æ²¡æœ‰æ—¥å¿—ï¼Œå¿«å»å†™ä¸€ç¯‡å§~</text>
      <text class="empty-hint">å‘å¸ƒæ—¥å¿—å¯è·å¾—é‡‘å¸å¥–åŠ±å“¦</text>
    </view>
  </view>
</view>
