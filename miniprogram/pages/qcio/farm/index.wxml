<!-- å†œåœºé¡µé¢ - Win98 é£æ ¼ -->
<view class="farm-container">
  <!-- Win98 çª—å£ -->
  <view class="win98-window">
    <!-- æ ‡é¢˜æ  -->
    <view class="win98-title-bar">
      <view class="win98-title-text">ğŸŒ¾ æˆ‘çš„å†œåœº</view>
      <view class="win98-title-controls">
        <button class="win98-btn-close" bindtap="goBack">Ã—</button>
      </view>
    </view>

    <!-- çª—å£å†…å®¹ -->
    <view class="win98-content">
      <!-- å†œåœºä¿¡æ¯æ  -->
      <view class="farm-info-bar">
        <view class="info-item" bindtap="showLevelInfo">
          <text class="info-label">ç­‰çº§:</text>
          <text class="info-value clickable">Lv.{{farmProfile ? farmProfile.farmLevel : 1}}</text>
        </view>
        <view class="info-item" bindtap="showExpInfo">
          <text class="info-label">ç»éªŒ:</text>
          <text class="info-value clickable">{{farmProfile ? farmProfile.farmExp : 0}}</text>
        </view>
        <view class="info-item" bindtap="showCoinInfo">
          <text class="info-label">é‡‘å¸:</text>
          <text class="info-value gold clickable">ğŸ’° {{coins}}</text>
        </view>
      </view>

      <!-- å†œåœºåœŸåœ°ç½‘æ ¼ -->
      <view class="farm-tips">ğŸ’¡ ç‚¹å‡»ç©ºåœ°é€‰ç§å¹¶ç§æ¤ â€¢ ç‚¹å‡»æˆç†Ÿä½œç‰©æ”¶è·</view>
      <scroll-view class="farm-scroll" scroll-y>
        <view class="farm-grid">
          <block wx:for="{{plots}}" wx:key="index">
            <!-- å·²è§£é”åœŸåœ° -->
            <view
              class="farm-plot {{item.status}}"
              bindtap="onPlotTap"
              data-index="{{index}}"
              wx:if="{{index < unlockedPlots}}"
            >
              <!-- ç©ºåœ° -->
              <block wx:if="{{item.status === 'empty'}}">
              </block>

              <!-- ç”Ÿé•¿ä¸­ -->
              <block wx:elif="{{item.status === 'growing'}}">
                <text class="plot-crop-icon">{{item.cropIcon || 'ğŸŒ±'}}</text>
                <view class="progress-bar">
                  <view class="progress-fill" style="width: {{item.progress}}%"></view>
                </view>
                <text class="time-left">{{item.progress}}%</text>
              </block>

              <!-- å·²æˆç†Ÿ -->
              <block wx:elif="{{item.status === 'mature'}}">
                <text class="plot-crop-icon mature">{{item.cropIcon || 'ğŸŒ¾'}}</text>
              </block>
            </view>

            <!-- æœªè§£é”åœŸåœ° -->
            <view wx:elif="{{index < 24}}" class="farm-plot locked">
              <text class="plot-icon">ğŸ”’</text>
            </view>
          </block>
        </view>
      </scroll-view>

      <!-- æ“ä½œæŒ‰é’®æ  -->
      <view class="action-bar">
        <!-- å•†åº—åŠŸèƒ½æš‚æœªå®ç°ï¼Œæš‚æ—¶éšè— -->
        <!-- <button class="win98-btn-std" bindtap="openShop">ğŸª å•†åº—</button> -->
        <button class="win98-btn-std" bindtap="refreshData">ğŸ”„ åˆ·æ–°</button>
        <button class="win98-btn-std" bindtap="openLogModal">ğŸ“‹ è®°å½•</button>
      </view>
    </view>
  </view>

  <!-- å†œåœºè®°å½•å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showLogModal}}">
    <view class="modal-content" catchtap="">
      <view class="win98-window log-window">
        <view class="win98-title-bar">
          <text class="win98-title-text">ğŸ“‹ å†œåœºè®°å½•</text>
          <view class="win98-title-controls">
            <button class="win98-btn-close" bindtap="closeLogModal">Ã—</button>
          </view>
        </view>

        <view class="win98-content log-content">
          <scroll-view class="log-list" scroll-y wx:if="{{farmLogs.length > 0}}">
            <view class="log-item" wx:for="{{farmLogs}}" wx:key="index">
              <text class="log-time">{{item.time}}</text>
              <text class="log-action {{item.type}}">{{item.icon}} {{item.action}}</text>
              <text class="log-detail" wx:if="{{item.detail}}">{{item.detail}}</text>
            </view>
          </scroll-view>

          <view class="log-empty" wx:else>
            <text class="empty-icon">ğŸ“‹</text>
            <text class="empty-text">æš‚æ— å†œåœºè®°å½•</text>
            <text class="empty-hint">ç§æ¤ä½œç‰©åå°†æ˜¾ç¤ºç›¸å…³è®°å½•</text>
          </view>
        </view>

        <view class="log-footer">
          <button class="win98-btn-std log-ok-btn" bindtap="closeLogModal">å…³é—­</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å•†åº—å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showShopModal}}">
    <view class="modal-content" catchtap="">
      <view class="win98-window shop-window">
        <view class="win98-title-bar">
          <text class="win98-title-text">ğŸª å†œåœºå•†åº—</text>
          <view class="win98-title-controls">
            <button class="win98-btn-close" bindtap="closeShop">Ã—</button>
          </view>
        </view>

        <view class="win98-content shop-content">
          <!-- Tab åˆ‡æ¢ -->
          <view class="shop-tabs">
            <view
              class="shop-tab {{shopActiveTab === 'seeds' ? 'active' : ''}}"
              bindtap="switchShopTab"
              data-tab="seeds"
              wx:if="{{selectedPlotIndex >= 0}}"
            >
              ğŸŒ± ç§å­
            </view>
            <!-- è£…é¥°åŠŸèƒ½æš‚æœªå®ç°ï¼Œæš‚æ—¶éšè— -->
            <!-- <view
              class="shop-tab {{shopActiveTab === 'decorations' ? 'active' : ''}}"
              bindtap="switchShopTab"
              data-tab="decorations"
            >
              ğŸ¨ è£…é¥°
            </view> -->
          </view>

          <!-- ç§å­åˆ—è¡¨ -->
          <scroll-view class="shop-list" scroll-y wx:if="{{shopActiveTab === 'seeds'}}">
            <!-- ä¼ ç»Ÿä½œç‰© -->
            <view class="shop-section-title">ğŸŒ¾ ä¼ ç»Ÿä½œç‰©</view>
            <view class="shop-item" wx:for="{{traditionalCrops}}" wx:key="id" bindtap="buySeed" data-crop-type="traditional" data-crop-id="{{item.id}}">
              <text class="item-icon">{{item.icon}}</text>
              <view class="item-info">
                <text class="item-name">{{item.name}}</text>
                <text class="item-desc">{{item.durationText}}æˆç†Ÿ</text>
              </view>
              <view class="item-price">
                <text class="price-icon">ğŸ’°</text>
                <text>{{item.cost}}</text>
              </view>
            </view>

            <!-- å¿ƒæƒ…ä½œç‰© -->
            <view class="shop-section-title">ğŸ’­ å¿ƒæƒ…ä½œç‰©</view>
            <view class="shop-item" wx:for="{{moodCrops}}" wx:key="id" bindtap="buySeed" data-crop-type="mood" data-crop-id="{{item.id}}">
              <text class="item-icon">{{item.icon}}</text>
              <view class="item-info">
                <text class="item-name">{{item.name}}</text>
                <text class="item-desc">{{item.durationText}}æˆç†Ÿ</text>
              </view>
              <view class="item-price">
                <text class="price-icon">ğŸ’°</text>
                <text>{{item.cost}}</text>
              </view>
            </view>
          </scroll-view>

          <!-- è£…é¥°åˆ—è¡¨ - è£…é¥°åŠŸèƒ½æš‚æœªå®ç°ï¼Œæš‚æ—¶éšè— -->
          <!-- <scroll-view class="shop-list" scroll-y wx:if="{{shopActiveTab === 'decorations'}}">
            <view class="shop-item" wx:for="{{decorations}}" wx:key="id" bindtap="buyDecoration" data-id="{{item.id}}">
              <text class="item-icon">{{item.icon}}</text>
              <view class="item-info">
                <text class="item-name">{{item.name}}</text>
                <text class="item-desc">{{item.effect}}</text>
              </view>
              <view class="item-price">
                <text class="price-icon">ğŸ’°</text>
                <text>{{item.cost}}</text>
              </view>
            </view>
          </scroll-view> -->
        </view>
      </view>
    </view>
  </view>

  <!-- æ”¶è·ç»“æœå¼¹çª— - Win98 é£æ ¼ -->
  <view class="modal-overlay" wx:if="{{harvestResult.show}}">
    <view class="modal-content" catchtap="">
      <view class="win98-window harvest-window">
        <view class="win98-title-bar">
          <text class="win98-title-text">ğŸ‰ æ”¶è·æˆåŠŸ</text>
          <view class="win98-title-controls">
            <button class="win98-btn-close" bindtap="closeHarvestModal">Ã—</button>
          </view>
        </view>

        <view class="win98-content harvest-content">
          <view class="harvest-icon-section">
            <text class="harvest-crop-icon">{{harvestResult.icon}}</text>
            <text class="harvest-crop-name">{{harvestResult.cropName}}</text>
          </view>

          <view class="harvest-quality-section">
            <text class="quality-label">å“è´¨:</text>
            <block wx:for="{{[1,2,3,4,5]}}" wx:key="index">
              <text class="quality-star {{item <= harvestResult.quality ? 'active' : ''}}">â˜…</text>
            </block>
          </view>

          <view class="harvest-divider"></view>

          <view class="harvest-rewards">
            <view class="reward-row">
              <text class="reward-icon">ğŸ’°</text>
              <text class="reward-label">è·å¾—é‡‘å¸:</text>
              <text class="reward-value">{{harvestResult.sellPrice}}</text>
            </view>
            <view class="reward-row">
              <text class="reward-icon">â­</text>
              <text class="reward-label">è·å¾—ç»éªŒ:</text>
              <text class="reward-value">{{harvestResult.expGain}}</text>
            </view>
          </view>
        </view>

        <view class="harvest-footer">
          <button class="win98-btn-std harvest-ok-btn" bindtap="closeHarvestModal">ç¡®å®š</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å†œåœºä¿¡æ¯å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showInfoModal}}">
    <view class="modal-content" catchtap="">
      <view class="win98-window info-window">
        <view class="win98-title-bar">
          <text class="win98-title-text">{{infoModalTitle}}</text>
          <view class="win98-title-controls">
            <button class="win98-btn-close" bindtap="closeInfoModal">Ã—</button>
          </view>
        </view>

        <view class="win98-content info-content">
          <scroll-view class="info-scroll" scroll-y>
            <view class="info-sections">
              <!-- ç­‰çº§ä¿¡æ¯ -->
              <view class="info-section" wx:if="{{infoType === 'level'}}">
                <view class="info-section-title">ğŸŒ¾ å†œåœºç­‰çº§ç³»ç»Ÿ</view>
                <view class="info-row">
                  <text class="info-row-label">å½“å‰ç­‰çº§:</text>
                  <text class="info-row-value">Lv.{{farmProfile ? farmProfile.farmLevel : 1}}</text>
                </view>
                <view class="info-row">
                  <text class="info-row-label">è§£é”åœŸåœ°:</text>
                  <text class="info-row-value">{{unlockedPlots}} å—</text>
                </view>
                <view class="info-divider"></view>
                <view class="info-section-title">ğŸ“ˆ å‡çº§è¡¨</view>
                <view class="level-table">
                  <view class="level-table-row level-table-header">
                    <text class="col-level">ç­‰çº§</text>
                    <text class="col-exp">æ‰€éœ€ç»éªŒ</text>
                    <text class="col-plots">åœŸåœ°æ•°é‡</text>
                  </view>
                  <view class="level-table-row" wx:for="{{levelTable}}" wx:key="level">
                    <text class="col-level">Lv.{{item.level}}</text>
                    <text class="col-exp">{{item.exp}}</text>
                    <text class="col-plots">{{item.plots}}å—</text>
                  </view>
                </view>
              </view>

              <!-- ç»éªŒä¿¡æ¯ -->
              <view class="info-section" wx:if="{{infoType === 'exp'}}">
                <view class="info-section-title">â­ å†œåœºç»éªŒç³»ç»Ÿ</view>
                <view class="info-row">
                  <text class="info-row-label">å½“å‰ç»éªŒ:</text>
                  <text class="info-row-value">{{farmProfile ? farmProfile.farmExp : 0}}</text>
                </view>
                <view class="info-row">
                  <text class="info-row-label">ä¸‹ä¸€çº§:</text>
                  <text class="info-row-value">éœ€è¦ {{nextLevelExp}} ç»éªŒ</text>
                </view>
                <view class="info-row" wx:if="{{isMaxLevel}}">
                  <text class="info-row-value max-level">ğŸ‰ å·²è¾¾åˆ°æœ€é«˜ç­‰çº§ï¼</text>
                </view>
                <view class="info-divider"></view>
                <view class="info-section-title">ğŸ“– ç»éªŒè·å–æ–¹å¼</view>
                <view class="exp-list">
                  <view class="exp-item" wx:for="{{expSources}}" wx:key="name">
                    <text class="exp-name">{{item.name}}</text>
                    <text class="exp-value">+{{item.exp}} ç»éªŒ</text>
                  </view>
                </view>
              </view>

              <!-- é‡‘å¸ä¿¡æ¯ -->
              <view class="info-section" wx:if="{{infoType === 'coin'}}">
                <view class="info-section-title">ğŸ’° é‡‘å¸ç³»ç»Ÿ</view>
                <view class="info-row">
                  <text class="info-row-label">å½“å‰é‡‘å¸:</text>
                  <text class="info-row-value gold">ğŸ’° {{coins}}</text>
                </view>
                <view class="info-divider"></view>
                <view class="info-section-title">ğŸ“– é‡‘å¸è·å–æ–¹å¼</view>
                <view class="coin-list">
                  <view class="coin-item" wx:for="{{coinSources}}" wx:key="name">
                    <text class="coin-name">{{item.name}}</text>
                    <text class="coin-desc">{{item.desc}}</text>
                  </view>
                </view>
                <view class="info-divider"></view>
                <view class="info-section-title">ğŸ›’ é‡‘å¸ç”¨é€”</view>
                <view class="coin-uses">
                  <text class="coin-use">â€¢ è´­ä¹°ç§å­</text>
                  <!-- è£…é¥°åŠŸèƒ½æš‚æœªå®ç°ï¼Œæš‚æ—¶éšè— -->
                  <!-- <text class="coin-use">â€¢ è´­ä¹°è£…é¥°</text> -->
                  <text class="coin-use">â€¢ è§£é”åœŸåœ°</text>
                </view>
              </view>
            </view>
          </scroll-view>
        </view>

        <view class="info-footer">
          <button class="win98-btn-std info-ok-btn" bindtap="closeInfoModal">å…³é—­</button>
        </view>
      </view>
    </view>
  </view>
</view>
