<view class="desktop {{showBlueScreen ? 'blue-screen' : ''}} {{isRefreshing ? 'refreshing' : ''}}" style="background-color: {{desktopBackgrounds[desktopBgIndex]}};" bindlongpress="onDesktopLongPress" bindtap="onDesktopTap" catchtap="onDesktopTap">
  <!-- è“å±å½©è›‹è¦†ç›–å±‚ -->
  <view class="blue-screen-overlay" wx:if="{{showBlueScreen}}">
    <view class="bsod-content">
      <text class="bsod-title">Windows</text>
      <text class="bsod-text">å‡ºç°äº†ä¸€ä¸ªè‡´å‘½é”™è¯¯</text>
      <text class="bsod-text">æŒ‰ Ctrl+Alt+Del é‡å¯</text>
      <text class="bsod-code">0x000000ED: UNMOUNTABLE_BOOT_VOLUME</text>
      <text class="bsod-hint">é‚£ä¸ªå¹´ä»£çš„å™©æ¢¦...å½©è›‹å‘ç°ï¼</text>
    </view>
  </view>

  <!-- ç½‘ç®¡ç³»ç»Ÿæ’ä»¶ - å³ä¸Šè§’é¢æ¿ -->
  <view class="network-plugin-panel" wx:if="{{showNetworkPlugin}}">
    <view class="plugin-title-bar">
      <text class="plugin-title-text">ğŸ’° ä½™é¢</text>
      <text class="plugin-close-btn" bindtap="onCloseNetworkPlugin">Ã—</text>
    </view>
    <view class="plugin-body" bindtap="onNetworkPluginTap">
      <view class="plugin-row">
        <text class="plugin-row-icon">ğŸŒ</text>
        <view class="plugin-row-info">
          <text class="plugin-row-label">ç½‘è´¹</text>
          <text class="plugin-row-value">{{userNetFee}}åˆ†é’Ÿ</text>
        </view>
      </view>
      <view class="plugin-row">
        <text class="plugin-row-icon">ğŸ’</text>
        <view class="plugin-row-info">
          <text class="plugin-row-label">æ—¶å…‰å¸</text>
          <text class="plugin-row-value">{{userCoins}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¡Œé¢å›¾æ ‡åŒºåŸŸ - è‡ªåŠ¨æ¢åˆ—å¸ƒå±€ -->
  <view class="icon-grid" catchtap="onIconGridTap">
    <block wx:for="{{desktopIcons}}" wx:key="id">
      <view class="desktop-icon" id="{{item.id}}" bindtap="onIconTap" data-path="{{item.path}}">
        <view class="icon-img">{{item.icon}}</view>
        <text class="icon-label">{{item.name}}</text>
      </view>
    </block>
    <!-- éšè—å›¾æ ‡å½©è›‹ -->
    <view class="desktop-icon hidden-icon" wx:if="{{showHiddenIcon}}" bindtap="onHiddenIconTap">
      <view class="icon-img">ğŸ®</view>
      <text class="icon-label">???</text>
    </view>
  </view>

  <!-- æ¡Œé¢å³ä¸‹è§’éšè—åŒºåŸŸ - ç‚¹å‡»è§¦å‘éšè—å›¾æ ‡ -->
  <view class="hidden-trigger" bindtap="toggleHiddenIcon"></view>

  <!-- æ¡Œé¢åŠ©æ‰‹ï¼šå°ç‹®å­ (Office Assistant é£æ ¼) -->
  <view class="desktop-agent {{isDragging ? 'dragging' : ''}} {{isMidnightEgg ? 'midnight-glow' : ''}}" style="transform: translate({{agentTranslateX}}px, {{agentTranslateY}}px);"
        catchtouchstart="onAgentDragStart" catchtouchmove="onAgentDragMove" catchtouchend="onAgentDragEnd">
    <view class="agent-bubble {{showMessage ? 'show' : ''}}" wx:if="{{showMessage}}">
      <text>{{agentMessage}}</text>
    </view>
    <view class="agent-body agent-{{agentMood}}">ğŸ¦</view>
  </view>

  <!-- ä»»åŠ¡æ  -->
  <view class="taskbar" bindtap="onTaskbarTap">
    <view class="start-button {{showStartMenu ? 'active' : ''}}" bindtap="toggleStartMenu" catchtap="toggleStartMenu">
      <image class="win-logo" src="../../images/borders/border_win98.png" mode="aspectFit"></image>
      <text>Start</text>
    </view>

    <view class="taskbar-divider"></view>

    <view class="task-items">
      <!-- è¿è¡Œä¸­çš„ä»»åŠ¡ -->
    </view>

    <view class="system-tray">
      <view class="network-wrapper">
        <view class="tray-icon network-icon {{networkConnected ? 'online' : 'offline'}}" bindtap="onNetworkIconTap">
          {{networkConnected ? 'ğŸŒ' : 'âŒ'}}
        </view>
        <!-- ç½‘ç»œä¿¡æ¯æ°”æ³¡ -->
        <view class="network-bubble {{showNetworkInfo ? 'show' : ''}}" wx:if="{{showNetworkInfo}}">
          <text class="network-status-text">{{networkConnected ? '33.6K æ‹¨å·è¿æ¥' : 'ç½‘ç»œæœªè¿æ¥'}}</text>
          <text class="network-speed-text" wx:if="{{networkConnected}}">ç½‘è´¹: {{userNetFee}} åˆ†é’Ÿ</text>
          <text class="network-speed-text" wx:if="{{networkConnected}}">é€Ÿåº¦: 3-5 KB/s</text>
        </view>
      </view>
      <view class="volume-wrapper">
        <view class="tray-icon volume-icon" bindtap="onVolumeIconTap">
          {{soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'}}
        </view>
        <!-- éŸ³é‡çŠ¶æ€æ°”æ³¡ -->
        <view class="volume-bubble {{showVolumeInfo ? 'show' : ''}}" wx:if="{{showVolumeInfo}}">
          <text class="volume-status-text">{{soundEnabled ? 'éŸ³é‡å·²å¼€å¯' : 'é™éŸ³æ¨¡å¼'}}</text>
        </view>
      </view>
      <view class="tray-icon qcio-icon" bindtap="onQcioIconTap">
        ğŸ“Ÿ
      </view>
      <view class="system-time" bindtap="onTimeTap">{{systemTime}}</view>
    </view>
  </view>

  <!-- å¼€å§‹èœå•é®ç½© (ç‚¹å‡»å…³é—­) -->
  <view class="start-menu-mask" wx:if="{{showStartMenu}}" catchtap="toggleStartMenu"></view>

  <!-- å¼€å§‹èœå• (å¼¹å‡ºå±‚) -->
  <view class="start-menu" wx:if="{{showStartMenu}}">
    <!-- ç”¨æˆ·æ¨ªå¹… -->
    <view class="user-banner" bindtap="onUserBannerTap">
      <view class="user-avatar">{{userInfo.avatar}}</view>
      <view class="user-info">
        <text class="user-name">{{userInfo.nickname}}</text>
        <text class="user-status">åœ¨çº¿</text>
      </view>
    </view>
    <!-- èœå•é¡¹ -->
    <view class="menu-items">
      <view class="menu-item submenu {{showSubmenu ? 'selected' : ''}}" catchtap="toggleSubmenu">
        <text class="menu-icon">ğŸ®</text>
        <text class="menu-text">ç¨‹åº</text>
        <text class="submenu-arrow {{showSubmenu ? 'expanded' : ''}}">{{showSubmenu ? 'â–¾' : 'â–¸'}}</text>
      </view>
      <view class="menu-item" bindtap="onIconTap" data-path="/pages/my-documents/index">
        <text class="menu-icon">ğŸ“‚</text>
        <text class="menu-text">æˆ‘çš„æ–‡æ¡£</text>
      </view>
      <view class="menu-item" bindtap="onIconTap" data-path="/pages/my-computer/index">
        <text class="menu-icon">ğŸ’»</text>
        <text class="menu-text">æˆ‘çš„ç”µè„‘</text>
      </view>
      <view class="menu-item">
        <text class="menu-icon">âš™ï¸</text>
        <text class="menu-text">è®¾ç½®</text>
      </view>
      <view class="menu-item" bindtap="onIconTap" data-path="/pages/about/index">
        <text class="menu-icon">â“</text>
        <text class="menu-text">å¸®åŠ©</text>
      </view>
      <view class="menu-line"></view>
      <view class="menu-item shutdown-item">
        <text class="menu-icon">ğŸ”Œ</text>
        <text class="menu-text">å…³æœº...</text>
      </view>
    </view>
  </view>

  <!-- ç¨‹åºå­èœå• (ç‹¬ç«‹å¼¹å‡ºå±‚) -->
  <view class="submenu-popup {{showSubmenu ? 'show' : ''}}" catchtap="stopPropagation">
    <view class="submenu-item" catchtap="onIconTap" data-path="/pages/mars/index">
      <text class="submenu-icon">ğŸª</text>
      <text class="submenu-text">ç«æ˜Ÿæ–‡è½¬æ¢å™¨</text>
    </view>
    <view class="submenu-item" catchtap="onIconTap" data-path="/pages/translator/index">
      <text class="submenu-icon">ğŸ’”</text>
      <text class="submenu-text">å¿§ä¼¤åˆæˆå™¨</text>
    </view>
    <view class="submenu-item" catchtap="onIconTap" data-path="/pages/star-explorer/index">
      <text class="submenu-icon">ğŸ’£</text>
      <text class="submenu-text">è‘¬çˆ±å¿ƒç¢</text>
    </view>
    <view class="submenu-item" catchtap="onIconTap" data-path="/pages/avatar/index">
      <text class="submenu-icon">ğŸ“¸</text>
      <text class="submenu-text">éä¸»æµç›¸æœº</text>
    </view>
  </view>

  <!-- å³é”®èœå•é®ç½© (ç‚¹å‡»å¤–éƒ¨å…³é—­) -->
  <view class="context-menu-mask" wx:if="{{showContextMenu}}" catchtap="hideContextMenu"></view>

  <!-- å³é”®èœå• (å¼¹å‡ºå±‚) -->
  <view class="context-menu" wx:if="{{showContextMenu}}" style="left: {{contextMenuX}}px; top: {{contextMenuY}}px;">
    <view class="context-menu-item" bindtap="refreshDesktop">
      <text class="context-icon">ğŸ”„</text> åˆ·æ–°(E)
    </view>
    <view class="menu-line"></view>
    <view class="context-menu-item" bindtap="showSystemInfo">
      <text class="context-icon">ğŸ“Š</text> ç³»ç»Ÿä¿¡æ¯(I)
    </view>
    <view class="context-menu-item" bindtap="openNetworkSystem">
      <text class="context-icon">âš™ï¸</text> ç½‘ç®¡ç³»ç»Ÿ(N)
    </view>
    <view class="context-menu-item" bindtap="showAgentSettings">
      <text class="context-icon">ğŸ¦</text> åŠ©æ‰‹è®¾ç½®(A)
    </view>
    <view class="context-menu-item" bindtap="showAbout">
      <text class="context-icon">ğŸ“±</text> å…³äº(A)
    </view>
  </view>

  <!-- Win98 é”™è¯¯å¼¹çª— -->
  <view class="win98-overlay" wx:if="{{showErrorDialog}}" bindtap="hideErrorDialog">
    <view class="win98-window error-dialog" catchtap="stopPropagation">
      <view class="win98-title-bar">
        <view class="win98-title-text">âš ï¸ é”™è¯¯</view>
        <view class="win98-title-controls">
          <button class="win98-btn-close" bindtap="hideErrorDialog">Ã—</button>
        </view>
      </view>
      <view class="win98-window-body">
        <view class="error-dialog-content">
          <view class="error-icon">âŒ</view>
          <view class="error-messages">
            <text class="error-title">æ–‡ä»¶å·²æŸå</text>
            <text class="error-text">æ— æ³•æ‰“å¼€è¯¥ç¨‹åºã€‚</text>
            <text class="error-text">è¯·å°è¯•é‡æ–°å®‰è£…ã€‚</text>
            <text class="error-code">é”™è¯¯ä»£ç : 0x80070002</text>
          </view>
        </view>
        <view class="dialog-actions">
          <button class="win98-btn-std" bindtap="hideErrorDialog">ç¡®å®š</button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¥æœŸå¼¹çª—é®ç½© (ç‚¹å‡»å¤–éƒ¨å…³é—­) -->
  <view class="start-menu-mask" wx:if="{{showDateDialog}}" catchtap="hideDateDialog"></view>

  <!-- æ—¥æœŸå¼¹çª— - Windowsé£æ ¼å³ä¸‹è§’å¼¹å‡º -->
  <view class="date-dialog" wx:if="{{showDateDialog}}" catchtap="stopPropagation">
    <view class="date-dialog-content">
      <!-- æ—¥å†å¤´éƒ¨ï¼šå¹´æœˆ -->
      <view class="calendar-header">
        <text class="calendar-year">{{calendarYear}}</text>
        <text class="calendar-title">å¹´</text>
        <text class="calendar-month">{{calendarMonth}}</text>
        <text class="calendar-title">æœˆ</text>
      </view>

      <!-- æ˜ŸæœŸæ ‡é¢˜è¡Œ -->
      <view class="weekday-header">
        <text class="weekday-title">æ—¥</text>
        <text class="weekday-title">ä¸€</text>
        <text class="weekday-title">äºŒ</text>
        <text class="weekday-title">ä¸‰</text>
        <text class="weekday-title">å››</text>
        <text class="weekday-title">äº”</text>
        <text class="weekday-title">å…­</text>
      </view>

      <!-- æ—¥å†ç½‘æ ¼ -->
      <view class="calendar-grid">
        <block wx:for="{{calendarDays}}" wx:key="index">
          <view class="calendar-day-cell {{item.isToday ? 'today' : ''}}" wx:if="{{item.day !== 0}}">
            {{item.day}}
          </view>
          <view class="calendar-day-cell" wx:else></view>
        </block>
      </view>

      <!-- æ—¥æœŸä¿¡æ¯ -->
      <view class="date-info">
        <view class="info-row">
          <text class="info-label">å½“å‰:</text>
          <text class="info-value">{{fullDateTime}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">å†œå†:</text>
          <text class="info-value">{{lunarDate}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·ç¼–è¾‘å¼¹çª—é®ç½© -->
  <view class="start-menu-mask" wx:if="{{showUserEditDialog}}" catchtap="closeUserEditDialog"></view>

  <!-- ç”¨æˆ·ç¼–è¾‘å¼¹çª— -->
  <view class="user-edit-dialog" wx:if="{{showUserEditDialog}}" catchtap="stopPropagation">
    <view class="win98-title-bar">
      <view class="win98-title-text">ğŸ‘¤ ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯</view>
      <view class="win98-title-controls">
        <button class="win98-btn-close" bindtap="closeUserEditDialog">Ã—</button>
      </view>
    </view>
    <view class="win98-window-body">
      <view class="user-edit-content">
        <!-- å¤´åƒé€‰æ‹© -->
        <view class="edit-section">
          <text class="edit-label">é€‰æ‹©å¤´åƒï¼š</text>
          <view class="avatar-grid">
            <view
              class="avatar-choice {{editAvatar === item ? 'selected' : ''}}"
              wx:for="{{avatarList}}"
              wx:key="index"
              bindtap="selectAvatar"
              data-avatar="{{item}}"
            >
              {{item}}
            </view>
          </view>
        </view>

        <!-- æ˜µç§°è¾“å…¥ -->
        <view class="edit-section">
          <text class="edit-label">ä¿®æ”¹æ˜µç§°ï¼š</text>
          <input
            class="win98-input nickname-input"
            value="{{editNickname}}"
            bindinput="onNicknameInput"
            maxlength="12"
            placeholder="è¯·è¾“å…¥æ˜µç§°ï¼ˆæœ€å¤š12å­—ï¼‰"
          />
        </view>
      </view>

      <view class="dialog-actions">
        <button class="win98-btn-std" bindtap="saveUserInfo">ç¡®å®š</button>
        <button class="win98-btn-std" bindtap="closeUserEditDialog">å–æ¶ˆ</button>
      </view>
    </view>
  </view>

  <!-- ç³»ç»Ÿä¿¡æ¯å¼¹çª—é®ç½© -->
  <view class="win98-overlay" wx:if="{{showSystemInfoDialog}}" bindtap="hideSystemInfoDialog">
    <view class="win98-window system-info-dialog" catchtap="stopPropagation">
      <view class="win98-title-bar">
        <view class="win98-title-text">ğŸ“Š ç³»ç»Ÿä¿¡æ¯</view>
        <view class="win98-title-controls">
          <button class="win98-btn-close" bindtap="hideSystemInfoDialog">Ã—</button>
        </view>
      </view>
      <view class="win98-window-body">
        <view class="system-info-content">
          <text class="info-title">åƒç¦§æ—¶å…‰æœº v1.0</text>
          <view class="info-list">
            <view class="info-item">
              <text class="info-label">æ“ä½œç³»ç»Ÿ:</text>
              <text class="info-value">{{systemInfoData.os}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">å¤„ç†å™¨:</text>
              <text class="info-value">{{systemInfoData.cpu}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">å†…å­˜:</text>
              <text class="info-value">{{systemInfoData.memory}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">æ˜¾å¡:</text>
              <text class="info-value">{{systemInfoData.gpu}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">æ˜¾ç¤ºå™¨:</text>
              <text class="info-value">{{systemInfoData.display}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">å½“å‰æ—¶é—´:</text>
              <text class="info-value">{{systemInfoData.time}}</text>
            </view>
            <view class="info-item">
              <text class="info-label">ç½‘ç»œçŠ¶æ€:</text>
              <text class="info-value">{{systemInfoData.network}}</text>
            </view>
          </view>
        </view>
        <view class="dialog-actions">
          <button class="win98-btn-std" bindtap="hideSystemInfoDialog">ç¡®å®š</button>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ©æ‰‹è®¾ç½®å¼¹çª—é®ç½© -->
  <view class="win98-overlay" wx:if="{{showAgentSettingsDialog}}" bindtap="hideAgentSettingsDialog">
    <view class="win98-window agent-settings-dialog" catchtap="stopPropagation">
      <view class="win98-title-bar">
        <view class="win98-title-text">ğŸ¦ åŠ©æ‰‹è®¾ç½®</view>
        <view class="win98-title-controls">
          <button class="win98-btn-close" bindtap="hideAgentSettingsDialog">Ã—</button>
        </view>
      </view>
      <view class="win98-window-body">
        <view class="agent-settings-content">
          <text class="settings-text">{{agentSettingsMessage}}</text>
        </view>
        <view class="dialog-actions">
          <button class="win98-btn-std" bindtap="hideAgentSettingsDialog">çŸ¥é“äº†</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å…³äºå¼¹çª—é®ç½© -->
  <view class="win98-overlay" wx:if="{{showAboutDialog}}" bindtap="hideAboutDialog">
    <view class="win98-window about-dialog" catchtap="stopPropagation">
      <view class="win98-title-bar">
        <view class="win98-title-text">ğŸ“± å…³äºåƒç¦§æ—¶å…‰æœº</view>
        <view class="win98-title-controls">
          <button class="win98-btn-close" bindtap="hideAboutDialog">Ã—</button>
        </view>
      </view>
      <view class="win98-window-body">
        <view class="about-content">
          <text class="about-title">åƒç¦§æ—¶å…‰æœº v1.0</text>
          <text class="about-text">ä¸€æ¬¾æ€€æ—§é£æ ¼çš„å¾®ä¿¡å°ç¨‹åºï¼Œ</text>
          <text class="about-text">å¸¦ä½ å›åˆ°2005å¹´çš„QQæ—¶ä»£ã€‚</text>
          <view class="about-features">
            <text class="about-feature">â€¢ Windows 98 æ¡Œé¢é£æ ¼</text>
            <text class="about-feature">â€¢ 100+ AI èŠå¤©å¥½å‹</text>
            <text class="about-feature">â€¢ 14ä¸ªéšè—å½©è›‹</text>
            <text class="about-feature">â€¢ åŒä»£å¸ç³»ç»Ÿ</text>
            <text class="about-feature">â€¢ ç»å…¸å°æ¸¸æˆ</text>
          </view>
        </view>
        <view class="dialog-actions">
          <button class="win98-btn-std" bindtap="hideAboutDialog">ç¡®å®š</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å½©è›‹å‘ç°å¼¹çª— -->
  <view class="win98-overlay" wx:if="{{showEggDiscoveryDialog}}" bindtap="hideEggDiscoveryDialog">
    <view class="win98-window egg-discovery-dialog" catchtap="stopPropagation">
      <view class="win98-title-bar">
        <view class="win98-title-text">ğŸ‰ å‘ç°å½©è›‹ï¼</view>
        <view class="win98-title-controls">
          <button class="win98-btn-close" bindtap="hideEggDiscoveryDialog">Ã—</button>
        </view>
      </view>
      <view class="win98-window-body">
        <view class="egg-discovery-content">
          <view class="egg-icon-wrapper">
            <text class="egg-icon-emoji">ğŸ¥š</text>
          </view>
          <view class="egg-discovery-info">
            <text class="egg-name">{{eggDiscoveryData.name}}</text>
            <text class="egg-description">"{{eggDiscoveryData.description}}"</text>
            <view class="egg-rarity-badge rarity-{{eggDiscoveryData.rarity}}">
              <text class="rarity-text">{{eggDiscoveryData.rarityName}}</text>
            </view>
            <text class="egg-reward">å¥–åŠ±: {{eggDiscoveryData.rewardText}}</text>
          </view>
        </view>
        <view class="dialog-actions">
          <button class="win98-btn-std" bindtap="hideEggDiscoveryDialog">å¤ªæ£’äº†ï¼</button>
        </view>
      </view>
    </view>
  </view>

  <!-- ååˆ†åŠ¨å¬æ’­æ”¾å™¨ç»„ä»¶ -->
  <ttplayer show="{{showTTPlayer}}" bindclose="onCloseTTPlayer"></ttplayer>

  <!-- æˆ‘çš„ç”µè„‘ç»„ä»¶ -->
  <my-computer show="{{showMyComputer}}" zIndex="{{myComputerZIndex}}" bindclose="onCloseMyComputer" bindkonamihalf="onKonamiHalfComplete"></my-computer>

  <!-- ç½‘ç®¡ç³»ç»Ÿç»„ä»¶ -->
  <network-neighborhood show="{{showNetworkSystem}}" zIndex="{{networkSystemZIndex}}" bindclose="onCloseNetworkSystem"></network-neighborhood>

  <!-- æˆ‘çš„æ–‡æ¡£ç»„ä»¶ -->
  <my-documents show="{{showMyDocuments}}" zIndex="{{myDocumentsZIndex}}" bindclose="onCloseMyDocuments"></my-documents>
</view>