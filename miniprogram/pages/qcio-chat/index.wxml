<view class="chat-container">
  <!-- èŠå¤©çª—å£ -->
  <view class="chat-window">
    <scroll-view
      class="chat-messages"
      scroll-y
      scroll-into-view="{{scrollToView}}"
      scroll-with-animation
    >
      <block wx:for="{{messages}}" wx:key="timestamp">
        <view
          class="message-row {{item.role === 'user' ? 'user-row' : 'ai-row'}}"
          id="msg-{{index}}"
        >
          <!-- AI æ¶ˆæ¯ -->
          <block wx:if="{{item.role === 'assistant'}}">
            <view class="message-avatar ai-avatar">{{contactAvatar}}</view>
            <view class="message-bubble ai-bubble" bindtap="copyMessage" data-content="{{item.content}}">
              <text class="message-text">{{item.content}}</text>
            </view>
          </block>

          <!-- ç”¨æˆ·æ¶ˆæ¯ -->
          <block wx:else>
            <view class="message-bubble user-bubble" bindtap="copyMessage" data-content="{{item.content}}">
              <text class="message-text">{{item.content}}</text>
            </view>
            <view class="message-avatar user-avatar">ğŸ‘¤</view>
          </block>
        </view>
      </block>

      <!-- å‘é€ä¸­æç¤º -->
      <view class="message-row ai-row" wx:if="{{isSending}}">
        <view class="message-avatar ai-avatar">{{contactAvatar}}</view>
        <view class="message-bubble ai-bubble sending-bubble">
          <text class="sending-text">å¯¹æ–¹æ­£åœ¨è¾“å…¥...</text>
        </view>
      </view>
    </scroll-view>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <view class="chat-input-area">
      <input
        class="chat-input"
        placeholder="è¯´ç‚¹ä»€ä¹ˆ..."
        value="{{inputText}}"
        bindinput="onInput"
        confirm-type="send"
        bindconfirm="sendMessage"
        disabled="{{isSending}}"
      />
      <button
        class="send-btn {{isSending ? 'disabled' : ''}}"
        bindtap="sendMessage"
        disabled="{{isSending}}"
      >
        {{isSending ? '...' : 'å‘é€'}}
      </button>
    </view>
  </view>

  <!-- çª—å£æ§åˆ¶æŒ‰é’® -->
  <view class="window-controls">
    <button class="win98-btn-sm" bindtap="goBack">å…³é—­</button>
  </view>
</view>
