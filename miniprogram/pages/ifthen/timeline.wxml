<!-- æ¸¸æˆä¸»ç•Œé¢ - æ—¶é—´çº¿é¡µé¢ -->
<view class="desktop">
  <view class="win98-window">
    <view class="win98-title-bar">
      <view class="win98-title-text">å¦‚æœå½“æ—¶.exe - æ¸¸æˆä¸­</view>
      <view class="win98-title-controls">
        <button class="win98-btn-minimize">_</button>
        <button class="win98-btn-maximize">â–¡</button>
        <button class="win98-btn-close" bindtap="goHome">Ã—</button>
      </view>
    </view>

    <view class="win98-window-body">
      <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
  <view class="top-bar">
    <view class="info-display">
      <text class="year">{{currentYear}}</text>
      <text class="year-label">å¹´</text>
      <text class="age">{{age}}</text>
      <text class="age-label">å²</text>
    </view>
    <view class="top-bar-actions">
      <text class="ending-link" bindtap="reopenEnding" wx:if="{{ending}}">æŸ¥çœ‹ç»“å±€</text>
      <text class="restart-link" bindtap="restartGame">é‡æ–°å¼€å§‹</text>
    </view>
  </view>

  <!-- å±æ€§é¢æ¿ -->
  <view class="attributes-panel">
    <view class="attr-item">
      <text class="attr-label">æŠ€æœ¯</text>
      <view class="attr-bar">
        <view class="attr-fill tech" style="width: {{attributes.tech_skill}}%"></view>
      </view>
      <text class="attr-value">{{attributes.tech_skill}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">ç¤¾äº¤</text>
      <view class="attr-bar">
        <view class="attr-fill social" style="width: {{attributes.social}}%"></view>
      </view>
      <text class="attr-value">{{attributes.social}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">è´¢å¯Œ</text>
      <view class="attr-bar">
        <view class="attr-fill wealth" style="width: {{attributes.wealth}}%"></view>
      </view>
      <text class="attr-value">{{attributes.wealth}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">å¥åº·</text>
      <view class="attr-bar">
        <view class="attr-fill health" style="width: {{attributes.health}}%"></view>
      </view>
      <text class="attr-value">{{attributes.health}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">å¿«ä¹</text>
      <view class="attr-bar">
        <view class="attr-fill happiness" style="width: {{attributes.happiness}}%"></view>
      </view>
      <text class="attr-value">{{attributes.happiness}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">é­…åŠ›</text>
      <view class="attr-bar">
        <view class="attr-fill charm" style="width: {{attributes.charm}}%"></view>
      </view>
      <text class="attr-value">{{attributes.charm}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">è¿æ°”</text>
      <view class="attr-bar">
        <view class="attr-fill luck" style="width: {{attributes.luck}}%"></view>
      </view>
      <text class="attr-value">{{attributes.luck}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">å­¦è¯†</text>
      <view class="attr-bar">
        <view class="attr-fill education" style="width: {{attributes.education}}%"></view>
      </view>
      <text class="attr-value">{{attributes.education}}</text>
    </view>
  </view>

  <!-- æ—¶é—´è½´åŒºåŸŸ -->
  <view class="timeline-section" bindtap="onTimelineTap">
    <view class="timeline-header">æ—¶å…‰è½´</view>
    <scroll-view class="timeline-scroll" scroll-y scroll-top="0" scroll-with-animation catchtap="onTimelineTap">
      <view class="timeline-list">
        <view class="timeline-item {{index === currentTimelineIndex ? 'active' : ''}}"
              wx:for="{{timelineData}}"
              wx:for-item="item"
              wx:for-index="index"
              wx:key="index"
              id="timeline-item-{{index}}">
          <view class="timeline-dot"></view>
          <view class="timeline-content">
            <text class="timeline-year">{{item.year}}</text>
            <text class="timeline-age">{{item.age}}å²</text>
            <text class="timeline-event" wx:if="{{item.displayTitle && item.displayTitle.length > 0}}">{{item.displayTitle}}</text>
            <text class="timeline-choice" wx:if="{{item.displayChoice && item.displayChoice.length > 0}}">{{item.displayChoice}}</text>
          </view>
        </view>
        <view class="timeline-empty" wx:if="{{timelineData.length === 0}}">
          <text>æš‚æ— è®°å½•,å¼€å§‹ä½ çš„æ—¶å…‰ä¹‹æ—…å§~</text>
        </view>
      </view>
    </scroll-view>
  </view>
    </view>

    <!-- çŠ¶æ€æ  -->
    <view class="status-bar">
      <text>Playing - Year {{currentYear}}</text>
    </view>
  </view>
</view>

<!-- äº‹ä»¶å¼¹çª— -->
<view class="event-overlay {{showEventCard ? 'visible' : ''}}" wx:if="{{showEventCard && currentEvent}}">
  <view class="event-window">
    <view class="event-title-bar">
      <view class="event-title-text">äº‹ä»¶ - {{currentYear}}å¹´</view>
      <view class="event-title-controls">
        <button class="event-btn-close" bindtap="closeEvent">Ã—</button>
      </view>
    </view>

    <view class="event-window-body">
      <view class="event-content">
        <text class="event-title">{{currentEvent.title}}</text>
        <text class="event-desc">{{currentEvent.description}}</text>

        <!-- å†å²èƒŒæ™¯ -->
        <view class="event-context" wx:if="{{currentEvent.context}}">
          <text class="context-label">å†å²èƒŒæ™¯</text>
          <text class="context-text">{{currentEvent.context}}</text>
        </view>
      </view>

      <!-- é€‰é¡¹æŒ‰é’® -->
      <view class="choices-container">
        <button
          class="choice-btn"
          wx:for="{{currentEvent.choices}}"
          wx:key="text"
          data-index="{{index}}"
          bindtap="makeChoice"
        >
          <text class="choice-text">{{item.text}}</text>
        </button>
      </view>
    </view>
  </view>
</view>

<!-- ç»“å±€å¼¹çª— -->
<view class="ending-overlay {{showEnding ? 'visible' : ''}}" wx:if="{{showEnding && ending}}">
  <view class="ending-card">
    <view class="ending-header">
      <text class="ending-icon">{{ending.icon || 'ğŸ“–'}}</text>
      <text class="ending-title">{{ending.title}}</text>
    </view>

    <view class="ending-content">
      <text class="ending-desc">{{ending.description}}</text>

      <!-- ç»“å±€å±æ€§å±•ç¤º -->
      <view class="ending-stats">
        <text class="stats-title">æœ€ç»ˆå±æ€§</text>
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-label">æŠ€æœ¯</text>
            <text class="stat-value">{{attributes.tech_skill}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">ç¤¾äº¤</text>
            <text class="stat-value">{{attributes.social}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">è´¢å¯Œ</text>
            <text class="stat-value">{{attributes.wealth}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å¥åº·</text>
            <text class="stat-value">{{attributes.health}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å¿«ä¹</text>
            <text class="stat-value">{{attributes.happiness}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">é­…åŠ›</text>
            <text class="stat-value">{{attributes.charm}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">è¿æ°”</text>
            <text class="stat-value">{{attributes.luck}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å­¦è¯†</text>
            <text class="stat-value">{{attributes.education}}</text>
          </view>
        </view>
      </view>

      <!-- ç»“å±€ç±»å‹æ ‡ç­¾ -->
      <view class="ending-tag type-{{ending.type}}">
        <text>{{ending.typeText}}</text>
      </view>
    </view>

    <view class="ending-actions">
      <button class="btn-close-ending" bindtap="closeEnding">å…³é—­</button>
      <button class="btn-share-ending" bindtap="shareEnding" open-type="share">åˆ†äº«</button>
      <button class="btn-restart-ending" bindtap="restartGame">å†æ¥ä¸€å±€</button>
      <button class="btn-home-ending" bindtap="goHome">è¿”å›é¦–é¡µ</button>
    </view>
  </view>
</view>
