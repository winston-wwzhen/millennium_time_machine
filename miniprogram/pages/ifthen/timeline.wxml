<!-- æ¸¸æˆä¸»ç•Œé¢ - æ—¶é—´çº¿é¡µé¢ -->
<view class="game-container">

  <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
  <view class="top-bar">
    <view class="year-display">
      <text class="year">{{currentYear}}</text>
      <text class="year-label">å¹´</text>
    </view>
    <view class="age-display">
      <text class="age">{{age}}</text>
      <text class="age-label">å²</text>
    </view>
  </view>

  <!-- å±æ€§é¢æ¿ -->
  <view class="attributes-panel">
    <view class="attr-item">
      <text class="attr-label">æŠ€æœ¯</text>
      <view class="attr-bar">
        <view class="attr-fill tech" style="width: {{attributes.tech_skill}}%"></view>
      </view>
      <text class="attr-value">{{attributes.tech_skill}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">ç¤¾äº¤</text>
      <view class="attr-bar">
        <view class="attr-fill social" style="width: {{attributes.social}}%"></view>
      </view>
      <text class="attr-value">{{attributes.social}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">è´¢å¯Œ</text>
      <view class="attr-bar">
        <view class="attr-fill wealth" style="width: {{attributes.wealth}}%"></view>
      </view>
      <text class="attr-value">{{attributes.wealth}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">å¥åº·</text>
      <view class="attr-bar">
        <view class="attr-fill health" style="width: {{attributes.health}}%"></view>
      </view>
      <text class="attr-value">{{attributes.health}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">å¿«ä¹</text>
      <view class="attr-bar">
        <view class="attr-fill happiness" style="width: {{attributes.happiness}}%"></view>
      </view>
      <text class="attr-value">{{attributes.happiness}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">é­…åŠ›</text>
      <view class="attr-bar">
        <view class="attr-fill charm" style="width: {{attributes.charm}}%"></view>
      </view>
      <text class="attr-value">{{attributes.charm}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">è¿æ°”</text>
      <view class="attr-bar">
        <view class="attr-fill luck" style="width: {{attributes.luck}}%"></view>
      </view>
      <text class="attr-value">{{attributes.luck}}</text>
    </view>
    <view class="attr-item">
      <text class="attr-label">å­¦è¯†</text>
      <view class="attr-bar">
        <view class="attr-fill education" style="width: {{attributes.education}}%"></view>
      </view>
      <text class="attr-value">{{attributes.education}}</text>
    </view>
  </view>

  <!-- äº‹ä»¶å¡ç‰‡åŒºåŸŸ -->
  <view class="event-area">
    <!-- äº‹ä»¶å¡ç‰‡ -->
    <view class="event-card {{eventCardVisible ? 'visible' : ''}}" wx:if="{{showEventCard && currentEvent}}">
      <view class="event-header">
        <text class="event-year">{{currentYear}}</text>
        <text class="event-age">{{age}}å²</text>
      </view>

      <view class="event-content">
        <text class="event-title">{{currentEvent.title}}</text>
        <text class="event-desc">{{currentEvent.description}}</text>

        <!-- å†å²èƒŒæ™¯ -->
        <view class="event-context" wx:if="{{currentEvent.context}}">
          <text class="context-label">å†å²èƒŒæ™¯</text>
          <text class="context-text">{{currentEvent.context}}</text>
        </view>
      </view>

      <!-- é€‰é¡¹æŒ‰é’® -->
      <view class="choices-container">
        <button
          class="choice-btn"
          wx:for="{{currentEvent.choices}}"
          wx:key="text"
          data-index="{{index}}"
          bindtap="makeChoice"
        >
          <text class="choice-text">{{item.text}}</text>
          <text class="choice-hint" wx:if="{{item.hint}}">{{item.hint}}</text>
        </button>
      </view>
    </view>

    <!-- é€‰æ‹©ç»“æœ -->
    <view class="choice-result {{choiceResultVisible ? 'visible' : ''}}" wx:if="{{choiceResultVisible}}">
      <text class="result-text">{{currentResult}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <button class="btn-home" bindtap="goHome">è¿”å›é¦–é¡µ</button>
    <button class="btn-restart" bindtap="restartGame">é‡æ–°å¼€å§‹</button>
  </view>

</view>

<!-- ç»“å±€å¼¹çª— -->
<view class="ending-overlay {{showEnding ? 'visible' : ''}}" wx:if="{{showEnding && ending}}">
  <view class="ending-card">
    <view class="ending-header">
      <text class="ending-icon">{{ending.icon || 'ğŸ“–'}}</text>
      <text class="ending-title">{{ending.title}}</text>
    </view>

    <view class="ending-content">
      <text class="ending-desc">{{ending.description}}</text>

      <!-- ç»“å±€å±æ€§å±•ç¤º -->
      <view class="ending-stats">
        <text class="stats-title">æœ€ç»ˆå±æ€§</text>
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-label">æŠ€æœ¯</text>
            <text class="stat-value">{{attributes.tech_skill}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">ç¤¾äº¤</text>
            <text class="stat-value">{{attributes.social}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">è´¢å¯Œ</text>
            <text class="stat-value">{{attributes.wealth}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å¥åº·</text>
            <text class="stat-value">{{attributes.health}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å¿«ä¹</text>
            <text class="stat-value">{{attributes.happiness}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">é­…åŠ›</text>
            <text class="stat-value">{{attributes.charm}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">è¿æ°”</text>
            <text class="stat-value">{{attributes.luck}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">å­¦è¯†</text>
            <text class="stat-value">{{attributes.education}}</text>
          </view>
        </view>
      </view>

      <!-- ç»“å±€ç±»å‹æ ‡ç­¾ -->
      <view class="ending-tag type-{{ending.type}}">
        <text>{{ending.typeText}}</text>
      </view>
    </view>

    <view class="ending-actions">
      <button class="btn-restart-ending" bindtap="restartGame">å†æ¥ä¸€å±€</button>
      <button class="btn-home-ending" bindtap="goHome">è¿”å›é¦–é¡µ</button>
    </view>
  </view>
</view>
