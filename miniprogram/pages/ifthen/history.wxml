<!-- ç»“å±€æ”¶é›† - Win98é£æ ¼ -->
<view class="desktop">
  <view class="win98-window">
    <view class="win98-title-bar">
      <view class="win98-title-text">ç»“å±€æ”¶é›†.exe</view>
      <view class="win98-title-controls">
        <button class="win98-btn-close" bindtap="closeWindow">Ã—</button>
      </view>
    </view>

    <view class="win98-window-body">
      <!-- ç»Ÿè®¡åŒºåŸŸ -->
      <view class="stats-section">
        <view class="stats-title">ğŸ“Š æ”¶é›†ç»Ÿè®¡</view>

        <view class="stats-row">
          <view class="stat-box">
            <view class="stat-label">å·²è§£é”ç»“å±€</view>
            <view class="stat-value">{{stats.totalEndings}}</view>
            <view class="stat-total">ä¸ª</view>
          </view>
          <view class="stat-box">
            <view class="stat-label">å®Œæˆåº¦</view>
            <view class="stat-value">{{stats.unlockRate}}</view>
            <view class="stat-percent">%</view>
          </view>
          <view class="stat-box">
            <view class="stat-label">æ€»æ¸¸ç©æ¬¡æ•°</view>
            <view class="stat-value">{{stats.totalPlays}}</view>
            <view class="stat-unit">å±€</view>
          </view>
        </view>

        <!-- ç±»å‹ç»Ÿè®¡ -->
        <view class="type-stats-grid">
          <view class="type-stat-box type-special">
            <text class="type-stat-icon">ğŸŒŸ</text>
            <view class="type-stat-info">
              <text class="type-stat-label">ç‰¹æ®Š/ä¼ å¥‡</text>
              <text class="type-stat-count">{{stats.typeStats.special}}</text>
            </view>
          </view>
          <view class="type-stat-box type-good">
            <text class="type-stat-icon">ğŸ˜Š</text>
            <view class="type-stat-info">
              <text class="type-stat-label">å¥½ç»“å±€</text>
              <text class="type-stat-count">{{stats.typeStats.good}}</text>
            </view>
          </view>
          <view class="type-stat-box type-normal">
            <text class="type-stat-icon">ğŸ˜</text>
            <view class="type-stat-info">
              <text class="type-stat-label">æ™®é€šç»“å±€</text>
              <text class="type-stat-count">{{stats.typeStats.normal}}</text>
            </view>
          </view>
          <view class="type-stat-box type-bad">
            <text class="type-stat-icon">ğŸ˜¢</text>
            <view class="type-stat-info">
              <text class="type-stat-label">åç»“å±€</text>
              <text class="type-stat-count">{{stats.typeStats.bad}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- å†å²è®°å½•åŒºåŸŸ -->
      <view class="history-section">
        <view class="section-header">
          <text class="section-title">ğŸ“‹ å†å²è®°å½•</text>
          <text class="section-count">({{historyList.length}}æ¡)</text>
        </view>

        <scroll-view class="history-scroll" scroll-y scroll-with-animation>
          <view class="history-list">
            <view class="history-item" wx:for="{{historyList}}" wx:key="_id" bindtap="viewEndingDetail" data-ending-id="{{item.endingId}}">
              <view class="history-item-left">
                <text class="history-icon">{{item.endingInfo.icon || 'ğŸ“–'}}</text>
              </view>
              <view class="history-item-right">
                <view class="history-title-row">
                  <text class="history-title">{{item.endingInfo.title || 'æœªçŸ¥ç»“å±€'}}</text>
                  <view class="history-tag type-{{item.endingInfo.type}}">{{item.endingInfo.typeText || 'æ™®é€š'}}</view>
                </view>
                <view class="history-meta">
                  <text class="meta-text">ğŸ‘¤ {{item.avatarName || 'Admin'}}</text>
                  <text class="meta-text">ğŸ‚ {{item.birthYear}}å¹´</text>
                  <text class="meta-text">{{item.gender === 'male' ? 'ğŸ‘¦ ç”·' : 'ğŸ‘§ å¥³'}}</text>
                  <text class="meta-text" wx:if="{{item.finalAttributes}}">ğŸ˜Š {{item.finalAttributes.happiness}}</text>
                </view>
                <view class="history-time">
                  <text class="time-text">{{item.createTime}}</text>
                </view>
              </view>
            </view>

            <!-- åŠ è½½æ›´å¤š -->
            <view class="load-more" wx:if="{{hasMore}}">
              <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸‹æ‹‰åŠ è½½æ›´å¤š'}}</text>
            </view>

            <!-- æ²¡æœ‰æ›´å¤š -->
            <view class="no-more" wx:if="{{!hasMore && historyList.length > 0}}">
              <text class="no-more-text">â”â”â” å·²ç»åˆ°åº•å•¦ â”â”â”</text>
            </view>

            <!-- ç©ºçŠ¶æ€ -->
            <view class="empty-state" wx:if="{{historyList.length === 0}}">
              <text class="empty-icon">ğŸ“­</text>
              <text class="empty-text">è¿˜æ²¡æœ‰æ¸¸ç©è®°å½•</text>
              <text class="empty-hint">å¿«å»ä½“éªŒä¸åŒçš„äººç”Ÿå§ï¼</text>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>

    <!-- æŒ‰é’®åŒºåŸŸ -->
    <view class="action-bar">
      <button class="win98-btn-std win98-btn-primary" bindtap="startNewGame">
        å¼€å§‹æ–°æ¸¸æˆ
      </button>
    </view>

    <!-- çŠ¶æ€æ  -->
    <view class="status-bar">
      <text>Ready - {{stats.totalEndings}} Endings Unlocked</text>
    </view>
  </view>
</view>

<!-- ç»“å±€è¯¦æƒ…å¼¹çª— - Win98 é£æ ¼ -->
<view class="ending-overlay {{showEndingDetail ? 'visible' : ''}}" wx:if="{{selectedEnding}}">
  <view class="ending-card" catchtap="closeEndingDetail">
    <view class="ending-header" catchtap="closeEndingDetail">
      <text class="ending-icon">{{selectedEnding.icon || 'ğŸ“–'}}</text>
      <text class="ending-title">{{selectedEnding.title}}</text>
      <view class="win98-close-btn" catchtap="closeEndingDetail">Ã—</view>
    </view>

    <view class="ending-content">
      <text class="ending-desc">{{selectedEnding.description}}</text>

      <!-- ç»“å±€ç±»å‹æ ‡ç­¾ -->
      <view class="ending-tag type-{{selectedEnding.type}}">
        <text>{{selectedEnding.typeText}}</text>
      </view>
    </view>

    <!-- æŒ‰é’® -->
    <view class="ending-actions">
      <button class="win98-btn-std win98-btn-share" catchtap="shareEndingPoster">
        ğŸ“¸ åˆ†äº«
      </button>
      <button class="win98-btn-std" catchtap="closeEndingDetail">ç¡®å®š</button>
    </view>
  </view>
</view>

<!-- æµ·æŠ¥é¢„è§ˆå¼¹çª— - Win98 é£æ ¼ -->
<view class="poster-overlay {{showPosterPreview ? 'visible' : ''}}" wx:if="{{posterImageUrl}}" catchtap="closePosterPreview">
  <view class="poster-preview-card" catchtap="stopPropagation">
    <view class="win98-title-bar">
      <view class="win98-title-text">åˆ†äº«é¢„è§ˆ</view>
      <view class="win98-title-controls">
        <button class="win98-btn-close" catchtap="closePosterPreview">Ã—</button>
      </view>
    </view>

    <view class="poster-preview-body">
      <image class="poster-image" src="{{posterImageUrl}}" mode="widthFix" show-menu-by-longpress />
    </view>

    <view class="poster-actions">
      <button class="win98-btn-std" catchtap="closePosterPreview">å…³é—­</button>
      <button class="win98-btn-std win98-btn-primary" catchtap="savePosterToAlbum">ä¿å­˜åˆ°ç›¸å†Œ</button>
    </view>
  </view>
</view>

<!-- æµ·æŠ¥ç”ŸæˆCanvas -->
<canvas type="2d" id="posterCanvas" class="poster-canvas" style="width: 375px; height: 600px; position: fixed; left: -9999px; top: -9999px;"></canvas>
