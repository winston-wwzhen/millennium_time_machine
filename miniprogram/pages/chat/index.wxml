<view class="desktop">
  <!-- 自定义弹窗 -->
  <view class="custom-modal-overlay" wx:if="{{showEmojiModal}}" catchtap="closeModal">
    <view class="custom-modal" catchtap="stopPropagation">
      <view class="custom-modal-header">
        <text class="custom-modal-title">系统提示</text>
        <view class="custom-modal-close" bindtap="closeModal">×</view>
      </view>
      <view class="custom-modal-body">
        <view class="custom-modal-icon">ⓘ</view>
        <view class="custom-modal-content">
          拜托！现在才2006年诶~
          <text></text>
          智能手机要等到2007年iPhone才出来呢！表情包还没那么丰富，乖乖用文字聊天吧~
        </view>
      </view>
      <view class="custom-modal-footer">
        <view class="retro-btn" bindtap="closeModal">好的啦</view>
      </view>
    </view>
  </view>

  <view class="window-frame chat-main">
    <view class="title-bar chat-title-bar">
      <view class="title-text">
        <text>{{contactName}} (在线) - 对话中</text>
      </view>
      <view class="btn-close" bindtap="goBack">×</view>
    </view>

    <!-- <view class="menu-bar">
      <text>文件(F)</text>
      <text>编辑(E)</text>
      <text>视频(V)</text>
      <text>工具(T)</text>
    </view> -->

    <view style="background:#ffffe0; color:#555; font-size:10px; padding:3px 5px; border-bottom:1px solid #808080; text-align:center; margin-bottom: 2px;">
       ⚠️ 温馨提示：对方是AI虚拟网友，内容仅供娱乐，请勿当真。
    </view>

    <scroll-view class="chat-history" scroll-y="true" scroll-into-view="{{scrollToView}}">
      <block wx:for="{{chatList}}" wx:key="index">
        <view class="chat-item left" wx:if="{{item.type === 'ai'}}">
          <view class="avatar ai-avatar">{{contactAvatar}}</view>
          <view class="bubble ai-bubble">
            <text user-select="true">{{item.content}}</text>
          </view>
        </view>

        <view class="chat-item right" wx:else>
          <view class="bubble my-bubble">
            <text user-select="true">{{item.content}}</text>
          </view>
          <view class="avatar my-avatar">{{myAvatar}}</view>
        </view>
      </block>
      <view id="msg-bottom" style="height: 1px;"></view>
    </scroll-view>

    <view class="chat-toolbar">
      <text catchtap="onEmoji">表情(I)</text>
      <text catchtap="onShake">震动(N)</text>
    </view>

    <view class="chat-input-area">
      <textarea 
        class="chat-input" 
        value="{{chatInput}}" 
        bindinput="onChatInput"
        bindconfirm="sendMessage"
        cursor-spacing="20"
        confirm-type="send"
      ></textarea>
      <view class="chat-actions">
        <view class="retro-btn sm-btn" bindtap="goBack">关闭(C)</view>
        <view class="retro-btn sm-btn primary" bindtap="sendMessage">发送(S)</view>
      </view>
    </view>
  </view>

  <!-- 彩蛋发现弹窗 -->
  <egg-discovery-dialog
    show="{{showEggDiscoveryDialog}}"
    eggName="{{eggDiscoveryData.name}}"
    eggDescription="{{eggDiscoveryData.description}}"
    eggRarity="{{eggDiscoveryData.rarity}}"
    eggRarityName="{{eggDiscoveryData.rarityName}}"
    eggRewardText="{{eggDiscoveryData.rewardText}}"
    bindclose="hideEggDiscoveryDialog">
  </egg-discovery-dialog>
</view>