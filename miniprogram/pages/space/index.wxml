<view class="win98-desktop">
  
  <view class="window-container main-window">
    <view class="title-bar">
      <view class="title-text">æˆ‘çš„ç©ºé—´ (My Space).exe</view>
      <view class="title-controls">
        <view class="control-box">_</view>
        <view class="control-box">Ã—</view>
      </view>
    </view>
    
    <view class="window-body">
      <view class="menu-bar">
        <view class="menu-item" bindtap="scanNetwork">
          <text>ç½‘ä¸Šé‚»å±…(N)</text>
        </view>
        <view class="menu-item" bindtap="openInventory">
          <text>æŸ¥çœ‹(V)</text>
        </view>
      </view>

      <view class="status-area bevel-inset">
        
        <block wx:if="{{!myStatus || myStatus.status === 'idle'}}">
          <view class="prompt-text">è¯·é€‰æ‹©è¦ç¼–è¯‘çš„æƒ…ç»ªä»£ç ï¼š</view>
          <view class="radio-group">
            <view class="radio-item {{selectedMood === item.type ? 'active' : ''}}"
                  wx:for="{{moodOptions}}" wx:key="type"
                  bindtap="selectMood" data-type="{{item.type}}">
              <text>{{item.icon}} {{item.name}}</text>
              <text wx:if="{{selectedMood === item.type}}"> â†</text>
            </view>
          </view>
          
          <button class="win98-btn" bindtap="startCompile">å¼€å§‹ç¼–è¯‘</button>
        </block>

        <block wx:else>
          <view class="process-info">
            <text>è¿›ç¨‹: {{myStatus.moodName}}</text>
            
            <view style="display: flex; justify-content: space-between; margin-top: 10rpx;">
              <text>å®Œæ•´æ€§: {{myStatus.remainingOutput}}/{{myStatus.totalOutput}}</text>
              <text wx:if="{{myStatus.remainingOutput < myStatus.totalOutput}}" style="color: red;">[è­¦å‘Š: æ•°æ®æ³„æ¼]</text>
            </view>

            <text wx:if="{{progress < 100}}">å‰©ä½™æ—¶é—´: {{timeLeftStr}}</text>
            <text wx:else style="color: green; font-weight: bold;">ç¼–è¯‘å®Œæˆ! (å¯å›æ”¶)</text>
          </view>
          
          <button class="win98-btn" wx:if="{{progress >= 100}}" bindtap="collect">
            å›æ”¶æ•°æ® (æ”¶)
          </button>

          <view class="log-area bevel-inset" style="margin-top: 20rpx; height: 100rpx; background: #FFF; overflow-y: scroll; padding: 10rpx;">
            <view wx:if="{{myStatus.stealedBy.length === 0}}" style="color: #999;">æš‚æ— è®¿é—®è®°å½•...</view>
            <view wx:for="{{myStatus.stealedBy}}" wx:key="index" style="font-size: 24rpx; color: red;">
              [!ALERT] é­åˆ°å…¥ä¾µ! æŸå¤± {{item.amount}} ç¢ç‰‡
            </view>
          </view>

        </block>

      </view>
      
      <view class="status-bar bevel-inset">
        <text>çŠ¶æ€: {{scanning ? 'æ­£åœ¨æ‰«æç«¯å£...' : 'å°±ç»ª'}}</text>
      </view>
    </view>
  </view>

  <view class="window-container modal-window" wx:if="{{showTargetWindow}}">
    <view class="title-bar active">
      <view class="title-text">è¿œç¨‹è¿æ¥: {{targetUser.nickName}}</view>
      <view class="title-controls">
        <view class="control-box" bindtap="closeTargetWindow">Ã—</view>
      </view>
    </view>
    <view class="window-body">
      <view class="target-info">
        <image class="target-avatar bevel-inset" src="{{targetUser.avatarUrl || '../../images/icons/computer.png'}}"></image>
        <view class="target-text">
          <view>å‘ç°å¯è®¿é—®æ•°æ®ï¼š</view>
          <view style="color: blue; font-weight: bold;">{{targetUser.moodName}}</view>
          <view style="font-size: 24rpx; color: #666;">çŠ¶æ€: æœªåŠ å¯† (å¯å¤åˆ¶)</view>
        </view>
      </view>
      <view class="dialog-footer">
        <button class="win98-btn" bindtap="copyData">å¤åˆ¶æ•°æ®</button>
        <button class="win98-btn" bindtap="closeTargetWindow">æ–­å¼€è¿æ¥</button>
      </view>
    </view>
  </view>

  <view class="window-container modal-window" wx:if="{{showInventory}}" style="top: 15vh; z-index: 200;">
    <view class="title-bar active">
      <view class="title-text">èµ„æºç®¡ç†å™¨ (Inventory)</view>
      <view class="title-controls">
        <view class="control-box" bindtap="closeInventory">Ã—</view>
      </view>
    </view>
    <view class="window-body">
      <view class="inventory-header bevel-inset" style="background: #FFF; padding: 10rpx; margin-bottom: 20rpx;">
        <view>ç®—åŠ›(Coins): <text style="color: blue; font-weight: bold;">{{inventory.coins}} BIT</text></view>
      </view>

      <view class="inventory-grid">
        <view style="font-size: 24rpx; margin-bottom: 10rpx;">å·²æ•è·çš„æƒ…ç»ªç¢ç‰‡:</view>
        <view class="fragment-list bevel-inset" style="background: #FFF; min-height: 150rpx; padding: 10rpx;">
          
          <block wx:if="{{!inventory.fragments || (inventory.fragments.sadness === 0 && inventory.fragments.lonely === 0 && inventory.fragments.love === 0)}}">
            <view style="padding: 20rpx; color: #888; text-align: center;">(ç©º)</view>
          </block>
          
          <view class="frag-item" wx:if="{{inventory.fragments.sadness}}">
            <text>ğŸ’§ å¿§ä¼¤æºä»£ç </text>
            <text>x{{inventory.fragments.sadness}}</text>
          </view>
           <view class="frag-item" wx:if="{{inventory.fragments.lonely}}">
            <text>ğŸš¬ å¯‚å¯è„šæœ¬</text>
            <text>x{{inventory.fragments.lonely}}</text>
          </view>
           <view class="frag-item" wx:if="{{inventory.fragments.love}}">
            <text>ğŸ¬ åˆæ‹DLL</text>
            <text>x{{inventory.fragments.love}}</text>
          </view>
        </view>
      </view>

      <view class="dialog-footer">
        <button class="win98-btn" bindtap="closeInventory">ç¡®å®š</button>
      </view>
    </view>
  </view>

</view>