# 千禧时光机 (old_story)

> 重现 2005 年 QQ 空间/QQ 聊天的怀旧小程序

一个充满非主流、火星文、伤感情怀的微信小程序，带你回到千禧年代的互联网记忆。

---

## 项目简介

"千禧时光机"是一个复古风格的社交模拟小程序，模拟 2005 年左右的 QQ 空间和 QQ 聊天体验。用户可以：

- 创建 5 位数字的 QCIO 账号（类似 QQ 号）
- 与 100 个 AI 网友聊天，每个都有独特的个性
- 加入 6 个 AI 群聊，体验群聊氛围
- 发布空间心情日志
- 玩心情农场小游戏
- 浏览他人空间，踩一踩留言

---

## 功能特性

### QCIO 社交系统

| 功能 | 说明 |
|------|------|
| 账号系统 | 5 位数字账号（10000-99999），固定密码 123456 |
| 个人资料 | 昵称、头像、签名、等级、在线状态 |
| 空间系统 | 访问量统计、访客记录、留言板 |
| 好友系统 | 从 100 个 AI 网友中随机分配 20 个好友 |

### AI 聊天系统

**36 种聊天模式**，包括但不限于：

| 模式 | 风格 | 示例 |
|------|------|------|
| qingwu | 轻舞飞扬（非主流） | "滴~ 莪湜輕舞飛颺..." |
| sadsoul | 忧郁王子 | "唉，夜空中的星星好寂寞..." |
| netadmin | 网管小哥 | "重启试试" |
| fortune_teller | 算命大师 | "卦象显示..." |
| mars | 火星文转换 | 输入"你好" -> "伱好ㄋ" |
| joker | 段子手 | 输出搞笑段子 |

**100 个 AI 网友**，分为 12 个分组：

| 分组 | 人数 | 风格 |
|------|------|------|
| 葬爱家族 | 22人 | 非主流火星文 |
| 网游开黑 | 6人 | 游戏爱好者 |
| 网吧常驻 | 6人 | 技术、网吧 |
| 网络评论家 | 7人 | 键盘侠、吐槽 |
| 神秘人士 | 9人 | 玄学、中二 |
| 情感咨询 | 6人 | 恋爱、八卦 |
| 学霸联盟 | 7人 | 学习、技术 |
| 文艺青年 | 8人 | 诗歌、古风 |
| 娱乐达人 | 7人 | 电影、音乐 |
| 佛系一族 | 5人 | 禅意、极简 |
| 普通人 | 7人 | 日常生活 |
| 工具人 | 10人 | 转换功能 |

### 群聊系统

**6 个群聊**，每个群 18-24 人：

| 群名 | 人数 | 风格 |
|------|------|------|
| 葬爱网游家族 | 24人 | qingwu |
| 网吧技术联盟 | 20人 | netadmin |
| 神秘学园 | 20人 | fortune_teller |
| 情感八卦圈 | 21人 | love_expert |
| 学霸文艺社 | 19人 | nerd |
| 普通生活馆 | 18人 | down_to_earth |

**群聊发言机制**：
- 每次发消息随机选择 1-6 个群成员回复
- 概率分布：1人40%、2人30%、3人15%、4人8%、5人5%、6人2%
- AI 回复之间有 0.8-1.8 秒随机延迟

---

## 技术架构

### 前端技术

- **框架**: 微信小程序原生框架
- **语言**: WXML + WXSS + JavaScript
- **UI**: 复古风格，模拟 QQ 2005 界面

### 后端技术

- **云开发**: 微信云开发 (wx-server-sdk)
- **云函数**:
  - `user` - 用户登录和管理
  - `qcio` - QCIO 社交功能
  - `chat` - AI 聊天核心
  - `mood_logic` - 心情农场游戏

### AI 能力

- **模型**: 智谱 AI GLM 系列
- **温度参数**: 根据模式动态调整 (0.2-0.95)
- **上下文**: 最近 20 条消息

---

## 数据库设计

详见 [数据库设计文档.md](docs/数据库设计文档.md)

### 核心数据表

| 表名 | 用途 |
|------|------|
| users | 用户基础信息 |
| qcio_users | QCIO 账号信息 |
| qcio_ai_contacts | AI 好友列表（100个）|
| qcio_groups | 群聊列表（6个）|
| qcio_mood_logs | 用户心情日志 |
| qcio_chat_history | 单人聊天历史 |
| qcio_group_chat_history | 群聊历史 |
| qcio_guestbook | 空间留言板 |
| mood_garden | 心情农场状态 |

---

## 安全机制

### 内容安全检测

使用微信 `msgSecCheck` API 进行内容安全校验：

- 输入检测：用户发送消息时
- 输出检测：AI 生成回复时

### 发送频率限制

| 限制项 | 数值 |
|--------|------|
| 冷却时间 | 2 秒 |
| 最大输入长度 | 50 字 |

### 数据隔离

- 所有云函数通过 `cloud.getWXContext()` 获取用户 openid
- 数据查询使用 `.where({ _openid: OPENID })` 确保隔离

---

## 项目结构

```
old_story/
├── cloudfunctions/       # 云函数
│   ├── chat/            # AI 聊天核心
│   ├── qcio/            # QCIO 社交功能
│   ├── user/            # 用户管理
│   └── mood_logic/      # 心情农场
├── miniprogram/         # 小程序前端
│   ├── pages/           # 页面
│   │   ├── chat/        # 单人聊天
│   │   ├── group-chat/  # 群聊
│   │   ├── qcio/        # QCIO 主页
│   │   ├── farm/        # 心情农场
│   │   └── ...
│   └── components/      # 组件
├── docs/                # 文档
│   └── 数据库设计文档.md
└── db-init/             # 数据库初始化
    ├── qcio_ai_contacts/  # AI 好友数据
    └── qcio_groups/       # 群聊数据
```

---

## 开发指南

### 环境准备

1. 安装微信开发者工具
2. 创建云开发环境
3. 配置 GLM API Key

### 云函数部署

```bash
# 在云函数目录右键 -> 上传并部署
cloudfunctions/chat/
cloudfunctions/qcio/
cloudfunctions/user/
cloudfunctions/mood_logic/
```

### 数据库初始化

1. 在云开发控制台创建数据库集合
2. 使用 `db-init/` 目录下的 JSON 文件导入数据

---

## 常见问题

**Q: 为什么老用户看不到好友？**

A: 老用户可能缺少 `myContacts` 字段。系统会在登录时自动检测并补充分配。

**Q: 群聊显示的成员数不对？**

A: 需要重新导入 `db-init/qcio_groups/groups_import.json` 数据到数据库。

**Q: AI 回复很慢？**

A: 这是正常的，模拟了 2005 年拨号上网的延迟感（开玩笑，实际是 API 调用时间）。

---

## 更新日志

### v2.0 (2025-01)
- QCIO 社交系统完整上线
- 36 种 AI 聊天模式
- 100 个 AI 网友，12 个分组
- 6 个群聊，随机发言机制
- 内容安全检测、频率限制
- 心情农场游戏

### v1.5 (2024-12)
- 千禧浏览器功能
- 火星文翻译器
- 非主流头像生成器
- 星域探险游戏

### v1.0 (2024-12)
- 初始版本发布

---

## 许可证

本项目仅供学习和娱乐使用。

---

## 致敬

本项目致敬：
- QQ 2005 / QQ 空间
- 非主流文化
- 葬爱家族
- 杀马特帝国
- 千禧年代的互联网记忆

> "承諾、絠什嚒用？還bùsんì洅見。"
