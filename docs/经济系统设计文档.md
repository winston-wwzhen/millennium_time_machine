# 千禧时光机 - 双代币经济系统设计文档

## 系统概述

千禧时光机采用双代币体系（时光币 + 网费），通过彩蛋探索和网费消耗创造游戏循环，为用户提供怀旧有趣的体验。系统设计遵循以下原则：

- **合规性**: 个人小程序，无广告、无充值、无社交裂变
- **游戏化**: 通过探索桌面发现彩蛋，获得时光币奖励
- **可持续**: 网费每日扣除，引导用户持续探索彩蛋

---

## 一、双代币体系

### 1.1 货币类型

| 货币 | 名称 | 图标 | 获取方式 | 主要用途 |
|------|------|------|----------|----------|
| 时光币 | Time Coins | 💎 | 发现彩蛋奖励 | 兑换网费、CDK等 |
| 网费 | Network Fee | 🌐 | 初始30天、时光币兑换 | AI 功能消耗 |

### 1.2 时光币获取规则

| 方式 | 数量 | 说明 |
|------|------|------|
| 普通彩蛋 | 400-1000 | 小狮子跳舞、小狮子说话、任务栏惊喜等 |
| 稀有彩蛋 | 1500-2000 | 蓝屏噩梦、隐藏图标、特殊时刻 |
| 史诗彩蛋 | 5000 | 深夜党专属（0点-1点） |
| 传说彩蛋 | 10000 | Konami秘籍代码 |

### 1.3 网费获取方式

| 方式 | 数量 | 说明 |
|------|------|------|
| 新用户注册 | 30天（43,200分钟） | 初始赠送 |
| 时光币兑换 | 1天/1000时光币 | 在网管系统兑换 |

---

## 二、游戏循环设计

### 2.1 核心循环

```
新用户注册 → 获得30天免费网费
        ↓
    每日登录 → 自动扣除1天网费
        ↓
  探索桌面 → 发现彩蛋 → 获得时光币
        ↓
  网管系统 → 时光币兑换网费
        ↓
  使用AI功能 → 消耗网费
        ↓
    回到每日登录
```

### 2.2 网费消耗规则

| 场景 | 消耗 | 说明 |
|------|------|------|
| 每日登录 | 1天（1440分钟） | 自动扣除，无论是否使用AI功能 |
| AI聊天 | 按实际使用 | 未来扩展功能 |

### 2.3 兑换比例

- **1000 时光币 = 1 天网费（1440 分钟）**
- 即 **1 时光币 ≈ 1.44 分钟网费**

---

## 三、彩蛋系统

### 3.1 彩蛋分类

| 稀有度 | 数量 | 奖励范围 | 示例 |
|--------|------|----------|------|
| 普通 | 7个 | 400-1000 时光币 | 小狮子跳舞、小狮子说话 |
| 稀有 | 3个 | 1500-2000 时光币 | 蓝屏噩梦、隐藏图标 |
| 史诗 | 1个 | 5000 时光币 | 深夜党专属 |
| 传说 | 1个 | 10000 时光币 | Konami秘籍代码 |

### 3.2 彩蛋列表

**普通彩蛋**（400-1000 时光币）：
- 🦁 舞动的小狮子 - 点击小狮子10次
- 💬 它会说话 - 长按小狮子
- 📂 底部秘密 - 点击任务栏10次
- 🎨 换了个心情 - 双击桌面背景切换
- 🗑️ 垃圾清理员 - 点击回收站
- 💻 电脑专家 - 点击我的电脑C盘
- 🌐 网瘾少年 - 点击浏览器图标

**稀有彩蛋**（1500-2000 时光币）：
- 💻 那个年代的噩梦 - 点击桌面空白处50次（蓝屏）
- 👁️ 消失的角落 - 点击桌面右下角出现隐藏图标
- ⏰ 特殊时刻 - 特定时间进入（如0点、12点）

**史诗彩蛋**（5000 时光币）：
- 🌙 深夜党专属 - 凌晨0点-1点进入桌面

**传说彩蛋**（10000 时光币）：
- 🎮 传说中的秘籍 - 输入Konami代码（↑↑↓↓←→←→BA）

---

## 四、用户界面设计

### 4.1 余额显示

**右上角网管插件**：
- 位置：桌面右上角
- 样式：纸质便利贴，低饱和度米色
- 内容：实时显示网费和时光币余额
- 交互：点击打开网管系统，X按钮关闭
- 层级：z-index 80（低于桌面应用）

**网管系统窗口**：
- 当前网费余额
- 当前时光币余额
- 兑换网费按钮
- 兑换记录
- 扣费记录

### 4.2 网络状态显示

**右下角系统托盘**：
- 网络图标：🌐（已连接）/ ❌（未连接）
- 点击显示：网络状态、网费余量、连接速度
- 音量图标：🔊（开启）/ 🔇（静音）

---

## 五、数据库设计

### 5.1 users - 用户双代币表

| 字段名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| _openid | String | 微信用户唯一标识 | - |
| netFee | Number | 网费余额（分钟） | 43200 |
| coins | Number | 时光币余额 | 0 |
| discoveredEggs | Array | 已发现的彩蛋ID列表 | [] |
| lastLoginDate | String | 上次登录日期 | null |
| createTime | Date | 创建时间 | serverDate |
| updateTime | Date | 更新时间 | serverDate |

### 5.2 user_transactions - 交易记录表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| _id | String | 交易唯一ID |
| _openid | String | 用户 openid |
| type | String | 交易类型 (earn/spend) |
| currency | String | 货币类型 (coins/netfee) |
| amount | Number | 金额（正数） |
| source | String | 来源/用途 |
| description | String | 描述 |
| balanceAfter | Number | 交易后余额 |
| createTime | Date | 交易时间 |

**source 来源列表**:

| source | 说明 | type | currency |
|--------|------|------|----------|
| initial_grant | 新用户注册赠送 | earn | netfee |
| daily_login | 每日登录扣除 | spend | netfee |
| discover_egg | 发现彩蛋 | earn | coins |
| exchange_netfee | 时光币兑换网费 | spend/earn | coins/netfee |

---

## 六、云函数API

### 6.1 用户登录

```javascript
wx.cloud.callFunction({
  name: 'user',
  data: { action: 'login' }
});

// 返回
{
  success: true,
  data: {
    netFee: 41760,  // 扣除1天后的余额
    coins: 0,
    avatar: "👤",
    avatarName: "用户"
  }
}
```

### 6.2 获取余额

```javascript
wx.cloud.callFunction({
  name: 'user',
  data: { action: 'getBalance' }
});

// 返回
{
  success: true,
  data: {
    netFee: 41760,
    coins: 500
  }
}
```

### 6.3 时光币兑换网费

```javascript
wx.cloud.callFunction({
  name: 'user',
  data: {
    action: 'exchangeNetFee',
    amount: 1000  // 1000时光币 = 1天网费
  }
});

// 返回
{
  success: true,
  data: {
    exchanged: 1440,  // 兑换获得的分钟数
    newNetFee: 43200,
    newCoins: 0
  }
}
```

### 6.4 发现彩蛋

```javascript
wx.cloud.callFunction({
  name: 'user',
  data: {
    action: 'discoverEgg',
    eggId: 'lion_dance'
  }
});

// 返回
{
  success: true,
  data: {
    eggName: '舞动的小狮子',
    reward: 500,
    rarity: 'common',
    alreadyDiscovered: false
  }
}
```

---

## 七、前端集成示例

### 7.1 余额显示组件

```javascript
// pages/index/index.js
data: {
  userNetFee: 0,
  userCoins: 0,
  showNetworkPlugin: true
},

onLoad() {
  this.loadUserBalance();
},

loadUserBalance() {
  wx.cloud.callFunction({
    name: 'user',
    data: { action: 'getBalance' }
  }).then(res => {
    if (res.result && res.result.success) {
      this.setData({
        userNetFee: res.result.data.netFee,
        userCoins: res.result.data.coins
      });
    }
  });
}
```

### 7.2 兑换功能

```javascript
// components/network-neighborhood/index.js
exchangeNetFee(e) {
  const amount = e.currentTarget.dataset.amount; // 1000/5000/10000

  wx.cloud.callFunction({
    name: 'user',
    data: {
      action: 'exchangeNetFee',
      amount: amount
    }
  }).then(res => {
    if (res.result && res.result.success) {
      wx.showModal({
        title: '兑换成功',
        content: `成功兑换 ${res.result.data.exchanged / 1440} 天网费！`,
        showCancel: false
      });
      this.loadBalance();
    }
  });
}
```

---

## 八、安全机制

### 8.1 防刷机制

| 措施 | 说明 |
|------|------|
| 云端校验 | 所有交易在云函数中进行校验 |
| 彩蛋去重 | 同一彩蛋只能发现一次 |
| 余额校验 | 兑换时检查时光币是否足够 |
| 事务性 | 余额更新和交易记录原子操作 |

### 8.2 数据一致性

- 双代币余额和交易记录同步更新
- 每日登录自动扣除网费
- 彩蛋发现状态云端存储，跨设备同步

---

## 九、版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v2.0 | 2025-12-26 | 双代币系统上线，彩蛋系统完整实现 |
| v3.0 | 2025-12-27 | 新增网管插件、动态z-index、音量切换等功能 |

---

> 注：本文档描述的是千禧时光机的实际双代币系统（时光币 + 网费）。如需查看QCIO社交系统的金币/Q点经济设计，请参考 `QCIO功能说明书.md`。
