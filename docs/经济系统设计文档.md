# QCIO 经济系统设计文档

## 系统概述

QCIO 经济系统采用双货币体系，支持 VIP 兑换码功能，为用户提供完整的游戏化体验。系统设计遵循以下原则：

- **合规性**: 个人小程序，无广告、无充值、无社交裂变
- **游戏化**: 通过签到、互动、成就等玩法获取货币
- **可持续**: 通过兑换码实现用户激励

---

## 一、双货币体系

### 1.1 货币类型

| 货币 | 名称 | 图标 | 获取方式 | 主要用途 |
|------|------|------|----------|----------|
| 金币 | Coins | 💰 | 签到、互动、游戏 | 种子、加速、基础装饰 |
| Q点 | Q-Points | 💎 | VIP兑换码、活动 | VIP会员、高级装饰 |

### 1.2 金币 (Coins) 获取规则

| 方式 | 数量 | 限制/频率 | 说明 |
|------|------|-----------|------|
| 每日签到 | 10金币 | 每天1次 | 基础奖励 |
| 连续签到3天 | +5金币 | 额外奖励 | 累计发放 |
| 连续签到7天 | +20金币 + 3Q点 | 额外奖励 | 每周里程碑 |
| 连续签到30天 | +50金币 + 10Q点 | 额外奖励 | 每月里程碑 |
| 发布心情日志 | 5金币 | 每天3次 | 内容创作激励 |
| 聊天互动 | 1金币 | 每天20条 | 社交活跃度 |
| 农场收获 | 10~50金币 | 根据产量 | 游戏产出 |
| 被踩空间 | 2金币 | 被动获得 | 社交传播 |

### 1.3 Q点 (Q-Points) 获取方式

| 方式 | 数量 | 说明 |
|------|------|------|
| VIP兑换码 | 10-100Q点 | 后台生成发放 |
| 等级奖励 | 5Q点 | 每升1级 |
| 成就解锁 | 3-10Q点 | 特殊成就 |

---

## 二、VIP会员特权

### 2.1 会员等级

| 等级 | 价格 | 特权 |
|------|------|------|
| 普通用户 | 免费 | 基础功能，20个AI网友 |
| VIP会员 | 100Q点/月 | 金色昵称、专属装扮、100个AI网友、特殊聊天模式 |

### 2.2 VIP权益详情

**基础权益（所有用户）**:
- 每日签到奖励
- 发布心情日志
- 聊天互动
- 农场游戏
- 空间访问
- 20个AI网友

**VIP专属权益**:
- 金色昵称显示
- 专属头像框
- 专属空间背景
- 100个AI网友（扩展50个）
- 特殊聊天模式解锁
- 农场加速折扣
- 优先客服支持

---

## 三、消费项目清单

### 3.1 金币消费

| 项目 | 价格 | 说明 |
|------|------|------|
| 普通种子 | 10金币 | 基础作物种子 |
| 优质种子 | 30金币 | 高产作物种子 |
| 稀有种子 | 50金币 | 特殊作物种子 |
| 加速成熟 | 20金币 | 立即收获 |
| 基础头像 | 50金币 | 新增普通头像 |
| 基础背景 | 100金币 | 聊天背景装饰 |
| 头像框 | 80金币 | 基础头像框 |

### 3.2 Q点消费

| 项目 | 价格 | 说明 |
|------|------|------|
| VIP月卡 | 100Q点 | 30天特权 |
| VIP年卡 | 1000Q点 | 365天特权（省200Q点） |
| 专属头像框 | 50Q点 | 永久专属装饰 |
| 专属空间装扮 | 80Q点 | 永久空间背景 |
| 解锁全部AI网友 | 200Q点 | 从20个扩展到100个 |
| 特殊聊天模式 | 30Q点 | 稀有AI模式解锁 |

---

## 四、成就系统

### 4.1 成就类别

| 类型 | 说明 | 示例 |
|------|------|------|
| count | 计数类 | 聊天100条、日志50篇 |
| login | 登录类 | 连续登录7天、30天 |
| social | 社交类 | 空间被访问100次 |
| collect | 收集类 | 收集10个头像 |

### 4.2 成就列表

| 成就 | 图标 | 类型 | 条件 | 金币奖励 | Q点奖励 |
|------|------|------|------|----------|---------|
| 话痨 | 💬 | count | 累计聊天100条 | 50 | 5 |
| 千禧网友 | 🌟 | login | 连续签到7天 | 30 | 3 |
| 人气王 | 🔥 | social | 空间被访问100次 | 50 | 5 |
| 农场主 | 🌾 | count | 农场收获50次 | 100 | 10 |
| 博客之星 | 📝 | count | 发布日志30篇 | 80 | 8 |
| 社交达人 | 🤝 | social | 踩空间200次 | 60 | 6 |
| 忠实粉丝 | 💎 | login | 连续签到30天 | 200 | 20 |
| 万言书 | 📚 | count | 聊天1000条 | 300 | 30 |

---

## 五、VIP兑换码系统

### 5.1 兑换码类型

| 类型 | value 示例 | 说明 |
|------|-----------|------|
| qpoints | 10/50/100 | Q点兑换码 |
| month_vip | 1 | VIP月卡 |
| year_vip | 12 | VIP年卡 |

### 5.2 兑换码属性

```javascript
{
  code: "ABC123XYZ",           // 兑换码（唯一）
  type: "qpoints",             // 类型
  value: 50,                   // 面值
  maxUses: 100,                // 最大使用次数
  usedCount: 0,                // 已使用次数
  isActive: true,              // 是否激活
  expireTime: "2025-12-31",    // 过期时间（可选）
  createTime: Date             // 创建时间
}
```

### 5.3 兑换码使用流程

```
用户输入兑换码
    ↓
验证兑换码存在性
    ↓
检查激活状态和有效期
    ↓
检查使用次数
    ↓
根据类型发放奖励
    ↓
更新使用次数
    ↓
返回发放结果
```

---

## 六、数据库设计

### 6.1 qcio_wallet - 用户钱包表

| 字段名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| _openid | String | 微信用户唯一标识 | - |
| coins | Number | 金币余额 | 0 |
| qpoints | Number | Q点余额 | 0 |
| totalCoinsEarned | Number | 历史累计获得金币 | 0 |
| totalQpointsEarned | Number | 历史累计获得Q点 | 0 |
| isVip | Boolean | 是否VIP | false |
| vipExpireTime | Date | VIP过期时间 | null |
| createTime | Date | 创建时间 | serverDate |
| updateTime | Date | 更新时间 | serverDate |

### 6.2 qcio_transactions - 交易记录表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| _id | String | 交易唯一ID |
| _openid | String | 用户 openid |
| type | String | 交易类型 (earn/spend) |
| currency | String | 货币类型 (coins/qpoints) |
| amount | Number | 金额（正数） |
| source | String | 来源/用途 |
| description | String | 描述 |
| balanceAfter | Number | 交易后余额 |
| createTime | Date | 交易时间 |

**source 来源列表**:

| source | 说明 | type |
|--------|------|------|
| daily_checkin | 每日签到 | earn |
| daily_checkin_bonus | 连续签到奖励 | earn |
| publish_mood_log | 发布心情日志 | earn |
| chat_interaction | 聊天互动 | earn |
| farm_harvest | 农场收获 | earn |
| space_visited | 被踩空间 | earn |
| level_up | 等级奖励 | earn |
| vip_code | VIP兑换码 | earn |
| achievement | 成就解锁 | earn |
| buy_seed | 购买种子 | spend |
| speedup_farm | 加速农场 | spend |
| buy_avatar | 购买头像 | spend |
| buy_vip_month | 购买VIP月卡 | spend |

### 6.3 qcio_daily_tasks - 每日任务记录表

| 字段名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| _openid | String | 用户 openid | - |
| date | String | 日期 (YYYY-MM-DD) | - |
| checkinDone | Boolean | 是否签到 | false |
| checkinStreak | Number | 连续签到天数 | 0 |
| moodLogCount | Number | 发布日志次数 | 0 |
| chatCount | Number | 聊天次数 | 0 |
| lastChatTime | Date | 最后聊天时间 | null |
| farmHarvestCount | Number | 农场收获次数 | 0 |
| createTime | Date | 创建时间 | serverDate |
| updateTime | Date | 更新时间 | serverDate |

### 6.4 qcio_vip_codes - VIP兑换码表

| 字段名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| code | String | 兑换码（唯一） | - |
| type | String | 类型 | - |
| value | Number | 面值 | - |
| maxUses | Number | 最大使用次数 | 1 |
| usedCount | Number | 已使用次数 | 0 |
| isActive | Boolean | 是否激活 | true |
| expireTime | Date | 兑换码过期时间 | null |
| createTime | Date | 创建时间 | serverDate |

### 6.5 qcio_achievements - 成就定义表

| 字段名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| _id | String | 成就唯一标识 | - |
| name | String | 成就名称 | - |
| description | String | 成就描述 | - |
| icon | String | 成就图标 emoji | - |
| type | String | 类型 (count/login/social/collect) | - |
| condition | Object | 达成条件 | {} |
| reward | Object | 奖励 (coins/qpoints) | {} |
| order | Number | 排序 | 0 |
| isEnabled | Boolean | 是否启用 | true |

### 6.6 qcio_user_achievements - 用户成就记录表

| 字段名 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| _openid | String | 用户 openid | - |
| achievementId | String | 成就ID | - |
| progress | Number | 当前进度 | 0 |
| isCompleted | Boolean | 是否完成 | false |
| unlockTime | Date | 解锁时间 | null |

---

## 七、云函数API

### 7.1 钱包相关

**获取钱包**
```javascript
wx.cloud.callFunction({
  name: 'qcio',
  data: { action: 'getWallet' }
});

// 返回
{
  success: true,
  data: {
    coins: 100,
    qpoints: 50,
    isVip: false
  }
}
```

**添加交易记录**
```javascript
wx.cloud.callFunction({
  name: 'qcio',
  data: {
    action: 'addTransaction',
    data: {
      type: 'earn',           // earn/spend
      currency: 'coins',      // coins/qpoints
      amount: 10,
      source: 'daily_checkin',
      description: '每日签到'
    }
  }
});
```

### 7.2 每日任务相关

**每日签到**
```javascript
wx.cloud.callFunction({
  name: 'qcio',
  data: { action: 'dailyCheckin' }
});

// 返回
{
  success: true,
  data: {
    streak: 7,                // 连续签到天数
    coinsEarned: 30,          // 本次获得金币
    qpointsEarned: 3,         // 本次获得Q点
    reward: {
      coins: 30,
      qpoints: 3
    }
  }
}
```

**获取每日任务状态**
```javascript
wx.cloud.callFunction({
  name: 'qcio',
  data: { action: 'getDailyTasks' }
});

// 返回
{
  success: true,
  data: {
    checkinDone: false,
    checkinStreak: 6,
    moodLogCount: 0,
    chatCount: 0,
    farmHarvestCount: 0,
    hasCheckedIn: false,
    totalCheckinDays: 6
  }
}
```

### 7.3 VIP兑换码相关

**兑换VIP码**
```javascript
wx.cloud.callFunction({
  name: 'qcio',
  data: {
    action: 'redeemVipCode',
    code: 'ABC123XYZ'
  }
});

// 返回
{
  success: true,
  data: {
    type: 'qpoints',
    amount: 50,
    message: '成功兑换50Q点'
  }
}
```

### 7.4 成就相关

**获取成就列表**
```javascript
wx.cloud.callFunction({
  name: 'qcio',
  data: { action: 'getAchievements' }
});

// 返回
{
  success: true,
  data: [
    {
      id: 'ach_chat_100',
      name: '话痨',
      description: '累计聊天100条',
      icon: '💬',
      progress: 50,
      isCompleted: false,
      reward: { coins: 50, qpoints: 5 }
    }
  ]
}
```

**检查并解锁成就**
```javascript
wx.cloud.callFunction({
  name: 'qcio',
  data: { action: 'checkAchievements' }
});

// 返回
{
  success: true,
  data: {
    unlockedCount: 2,
    achievements: [
      { id: 'ach_chat_100', name: '话痨', icon: '💬' }
    ]
  },
  message: '解锁了2个新成就！'
}
```

---

## 八、前端集成示例

### 8.1 钱包显示

```javascript
// pages/qcio/index.js
data: {
  wallet: {
    coins: 0,
    qpoints: 0,
    isVip: false
  }
},

onLoad() {
  this.loadWalletData();
},

loadWalletData() {
  wx.cloud.callFunction({
    name: 'qcio',
    data: { action: 'getWallet' }
  }).then(res => {
    if (res.result && res.result.success) {
      this.setData({
        wallet: res.result.data
      });
    }
  });
}
```

### 8.2 签到组件

```javascript
// components/daily-checkin.js
checkIn() {
  wx.cloud.callFunction({
    name: 'qcio',
    data: { action: 'dailyCheckin' }
  }).then(res => {
    if (res.result && res.result.success) {
      const { streak, reward } = res.result.data;

      wx.showModal({
        title: '签到成功！',
        content: `连续签到 ${streak} 天，获得 ${reward.coins} 金币！`,
        showCancel: false
      });

      // 通知父页面刷新钱包
      this.triggerEvent('checkin', { reward });
    }
  });
}
```

---

## 九、安全机制

### 9.1 防刷机制

| 措施 | 说明 |
|------|------|
| 每日限制 | 签到、日志、聊天均有每日次数限制 |
| 时间窗口 | 基于服务器的日期判断，不可篡改 |
| 余额校验 | 消费时检查余额是否足够 |
| 事务性 | 钱包更新和交易记录原子操作 |

### 9.2 数据一致性

- 钱包余额和交易记录同步更新
- VIP状态自动过期检测
- 连续签到断签自动重置

---

## 十、运营工具

### 10.1 兑换码生成工具

云函数 `generateVipCode`（需单独实现）：

```javascript
// 生成兑换码
wx.cloud.callFunction({
  name: 'admin',
  data: {
    action: 'generateCode',
    type: 'qpoints',
    value: 50,
    count: 100,        // 生成100个
    maxUses: 1,         // 每个码仅能用1次
    expireDays: 30      // 30天后过期
  }
});
```

### 10.2 数据统计

可通过云开发控制台查看：

- 钱包余额分布
- 交易流水统计
- VIP开通趋势
- 成就解锁率

---

## 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-01 | 初始版本，基础经济系统 |
| v1.1 | 2025-01 | 新增VIP兑换码功能 |
| v1.2 | 2025-01 | 新增成就系统 |
| v1.3 | 2025-01 | 完善心情日志奖励机制，优化UI布局 |
